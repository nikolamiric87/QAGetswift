'use strict';

exports.__esModule = true;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _from = require('babel-runtime/core-js/array/from');

var _from2 = _interopRequireDefault(_from);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _lodash = require('lodash');

var _readFileRelative = require('read-file-relative');

var _promisifyEvent = require('promisify-event');

var _promisifyEvent2 = _interopRequireDefault(_promisifyEvent);

var _pinkie = require('pinkie');

var _pinkie2 = _interopRequireDefault(_pinkie);

var _mustache = require('mustache');

var _mustache2 = _interopRequireDefault(_mustache);

var _asyncEventEmitter = require('../utils/async-event-emitter');

var _asyncEventEmitter2 = _interopRequireDefault(_asyncEventEmitter);

var _debugLogger = require('../notifications/debug-logger');

var _debugLogger2 = _interopRequireDefault(_debugLogger);

var _debugLog = require('./debug-log');

var _debugLog2 = _interopRequireDefault(_debugLog);

var _formattableAdapter = require('../errors/test-run/formattable-adapter');

var _formattableAdapter2 = _interopRequireDefault(_formattableAdapter);

var _errorList = require('../errors/error-list');

var _errorList2 = _interopRequireDefault(_errorList);

var _testRun = require('../errors/test-run/');

var _phase = require('./phase');

var _phase2 = _interopRequireDefault(_phase);

var _clientMessages = require('./client-messages');

var _clientMessages2 = _interopRequireDefault(_clientMessages);

var _type = require('./commands/type');

var _type2 = _interopRequireDefault(_type);

var _delay = require('../utils/delay');

var _delay2 = _interopRequireDefault(_delay);

var _markerSymbol = require('./marker-symbol');

var _markerSymbol2 = _interopRequireDefault(_markerSymbol);

var _testRunTracker = require('../api/test-run-tracker');

var _testRunTracker2 = _interopRequireDefault(_testRunTracker);

var _phase3 = require('../role/phase');

var _phase4 = _interopRequireDefault(_phase3);

var _pluginHost = require('../reporter/plugin-host');

var _pluginHost2 = _interopRequireDefault(_pluginHost);

var _browserConsoleMessages = require('./browser-console-messages');

var _browserConsoleMessages2 = _interopRequireDefault(_browserConsoleMessages);

var _unstableNetworkMode = require('../browser/connection/unstable-network-mode');

var _warningLog = require('../notifications/warning-log');

var _warningLog2 = _interopRequireDefault(_warningLog);

var _warningMessage = require('../notifications/warning-message');

var _warningMessage2 = _interopRequireDefault(_warningMessage);

var _utils = require('./commands/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const lazyRequire = require('import-lazy')(require);
const SessionController = lazyRequire('./session-controller');
const ClientFunctionBuilder = lazyRequire('../client-functions/client-function-builder');
const executeJsExpression = lazyRequire('./execute-js-expression');
const BrowserManipulationQueue = lazyRequire('./browser-manipulation-queue');
const TestRunBookmark = lazyRequire('./bookmark');
const AssertionExecutor = lazyRequire('../assertions/executor');
const actionCommands = lazyRequire('./commands/actions');
const browserManipulationCommands = lazyRequire('./commands/browser-manipulation');
const serviceCommands = lazyRequire('./commands/service');

const TEST_RUN_TEMPLATE = (0, _readFileRelative.readSync)('../client/test-run/index.js.mustache');
const IFRAME_TEST_RUN_TEMPLATE = (0, _readFileRelative.readSync)('../client/test-run/iframe.js.mustache');
const TEST_DONE_CONFIRMATION_RESPONSE = 'test-done-confirmation';
const MAX_RESPONSE_DELAY = 3000;

const ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT = 'all-driver-tasks-added-to-queue';

class TestRun extends _asyncEventEmitter2.default {
    constructor(test, browserConnection, screenshotCapturer, globalWarningLog, opts) {
        super();

        this[_markerSymbol2.default] = true;

        this.warningLog = new _warningLog2.default(globalWarningLog);

        this.opts = opts;
        this.test = test;
        this.browserConnection = browserConnection;

        this.phase = _phase2.default.initial;

        this.driverTaskQueue = [];
        this.testDoneCommandQueued = false;

        this.activeDialogHandler = null;
        this.activeIframeSelector = null;
        this.speed = this.opts.speed;
        this.pageLoadTimeout = this.opts.pageLoadTimeout;

        this.disablePageReloads = test.disablePageReloads || opts.disablePageReloads && test.disablePageReloads !== false;

        this.session = SessionController.getSession(this);

        this.consoleMessages = new _browserConsoleMessages2.default();

        this.pendingRequest = null;
        this.pendingPageError = null;

        this.controller = null;
        this.ctx = (0, _create2.default)(null);
        this.fixtureCtx = null;

        this.currentRoleId = null;
        this.usedRoleStates = (0, _create2.default)(null);

        this.errs = [];

        this.lastDriverStatusId = null;
        this.lastDriverStatusResponse = null;

        this.fileDownloadingHandled = false;
        this.resolveWaitForFileDownloadingPromise = null;

        this.addingDriverTasksCount = 0;

        this.debugging = this.opts.debugMode;
        this.debugOnFail = this.opts.debugOnFail;
        this.disableDebugBreakpoints = false;
        this.debugReporterPluginHost = new _pluginHost2.default({ noColors: false });

        this.browserManipulationQueue = new BrowserManipulationQueue(browserConnection, screenshotCapturer, this.warningLog);

        this.debugLog = new _debugLog2.default(this.browserConnection.userAgent);

        this.quarantine = null;

        this.injectable.scripts.push('/testcafe-core.js');
        this.injectable.scripts.push('/testcafe-ui.js');
        this.injectable.scripts.push('/testcafe-automation.js');
        this.injectable.scripts.push('/testcafe-driver.js');
        this.injectable.styles.push('/testcafe-ui-styles.css');

        this.requestHooks = (0, _from2.default)(this.test.requestHooks);

        this._initRequestHooks();
    }

    get id() {
        return this.session.id;
    }

    get injectable() {
        return this.session.injectable;
    }

    addQuarantineInfo(quarantine) {
        this.quarantine = quarantine;
    }

    addRequestHook(hook) {
        if (this.requestHooks.indexOf(hook) !== -1) return;

        this.requestHooks.push(hook);
        this._initRequestHook(hook);
    }

    removeRequestHook(hook) {
        if (this.requestHooks.indexOf(hook) === -1) return;

        (0, _lodash.pull)(this.requestHooks, hook);
        this._disposeRequestHook(hook);
    }

    _initRequestHook(hook) {
        hook.warningLog = this.warningLog;

        hook._instantiateRequestFilterRules();
        hook._instantiatedRequestFilterRules.forEach(rule => {
            this.session.addRequestEventListeners(rule, {
                onRequest: hook.onRequest.bind(hook),
                onConfigureResponse: hook._onConfigureResponse.bind(hook),
                onResponse: hook.onResponse.bind(hook)
            });
        });
    }

    _disposeRequestHook(hook) {
        hook.warningLog = null;

        hook._instantiatedRequestFilterRules.forEach(rule => {
            this.session.removeRequestEventListeners(rule);
        });
    }

    _initRequestHooks() {
        this.requestHooks.forEach(hook => this._initRequestHook(hook));
    }

    // Hammerhead payload
    _getPayloadScript() {
        this.fileDownloadingHandled = false;
        this.resolveWaitForFileDownloadingPromise = null;

        return _mustache2.default.render(TEST_RUN_TEMPLATE, {
            testRunId: (0, _stringify2.default)(this.session.id),
            browserId: (0, _stringify2.default)(this.browserConnection.id),
            browserHeartbeatRelativeUrl: (0, _stringify2.default)(this.browserConnection.heartbeatRelativeUrl),
            browserStatusRelativeUrl: (0, _stringify2.default)(this.browserConnection.statusRelativeUrl),
            browserStatusDoneRelativeUrl: (0, _stringify2.default)(this.browserConnection.statusDoneRelativeUrl),
            userAgent: (0, _stringify2.default)(this.browserConnection.userAgent),
            testName: (0, _stringify2.default)(this.test.name),
            fixtureName: (0, _stringify2.default)(this.test.fixture.name),
            selectorTimeout: this.opts.selectorTimeout,
            pageLoadTimeout: this.pageLoadTimeout,
            skipJsErrors: this.opts.skipJsErrors,
            retryTestPages: !!this.opts.retryTestPages,
            speed: this.speed,
            dialogHandler: (0, _stringify2.default)(this.activeDialogHandler)
        });
    }

    _getIframePayloadScript() {
        return _mustache2.default.render(IFRAME_TEST_RUN_TEMPLATE, {
            testRunId: (0, _stringify2.default)(this.session.id),
            selectorTimeout: this.opts.selectorTimeout,
            pageLoadTimeout: this.pageLoadTimeout,
            retryTestPages: !!this.opts.retryTestPages,
            speed: this.speed,
            dialogHandler: (0, _stringify2.default)(this.activeDialogHandler)
        });
    }

    // Hammerhead handlers
    getAuthCredentials() {
        return this.test.authCredentials;
    }

    handleFileDownload() {
        if (this.resolveWaitForFileDownloadingPromise) {
            this.resolveWaitForFileDownloadingPromise(true);
            this.resolveWaitForFileDownloadingPromise = null;
        } else this.fileDownloadingHandled = true;
    }

    handlePageError(ctx, err) {
        if (ctx.req.headers[_unstableNetworkMode.UNSTABLE_NETWORK_MODE_HEADER]) {
            ctx.closeWithError(500, err.toString());
            return;
        }

        this.pendingPageError = new _testRun.PageLoadError(err, ctx.reqOpts.url);

        ctx.redirect(ctx.toProxyUrl('about:error'));
    }

    // Test function execution
    _executeTestFn(phase, fn) {
        var _this = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this.phase = phase;

            try {
                yield fn(_this);
            } catch (err) {
                let screenshotPath = null;

                if (_this.opts.takeScreenshotsOnFails) screenshotPath = yield _this.executeCommand(new browserManipulationCommands.TakeScreenshotOnFailCommand());

                _this.addError(err, screenshotPath);
                return false;
            }

            return !_this._addPendingPageErrorIfAny();
        })();
    }

    _runBeforeHook() {
        var _this2 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this2.test.beforeFn) return yield _this2._executeTestFn(_phase2.default.inTestBeforeHook, _this2.test.beforeFn);

            if (_this2.test.fixture.beforeEachFn) return yield _this2._executeTestFn(_phase2.default.inFixtureBeforeEachHook, _this2.test.fixture.beforeEachFn);

            return true;
        })();
    }

    _runAfterHook() {
        var _this3 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this3.test.afterFn) return yield _this3._executeTestFn(_phase2.default.inTestAfterHook, _this3.test.afterFn);

            if (_this3.test.fixture.afterEachFn) return yield _this3._executeTestFn(_phase2.default.inFixtureAfterEachHook, _this3.test.fixture.afterEachFn);

            return true;
        })();
    }

    start() {
        var _this4 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _testRunTracker2.default.activeTestRuns[_this4.session.id] = _this4;

            yield _this4.emit('start');

            const onDisconnected = function onDisconnected(err) {
                return _this4._disconnect(err);
            };

            _this4.browserConnection.once('disconnected', onDisconnected);

            yield _this4.once('connected');

            yield _this4.emit('ready');

            if (yield _this4._runBeforeHook()) {
                yield _this4._executeTestFn(_phase2.default.inTest, _this4.test.fn);
                yield _this4._runAfterHook();
            }

            if (_this4.disconnected) return;

            _this4.browserConnection.removeListener('disconnected', onDisconnected);

            if (_this4.errs.length && _this4.debugOnFail) yield _this4._enqueueSetBreakpointCommand(null, _this4.debugReporterPluginHost.formatError(_this4.errs[0]));

            yield _this4.emit('before-done');

            yield _this4.executeCommand(new serviceCommands.TestDoneCommand());

            _this4._addPendingPageErrorIfAny();

            delete _testRunTracker2.default.activeTestRuns[_this4.session.id];

            yield _this4.emit('done');
        })();
    }

    // Errors
    _addPendingPageErrorIfAny() {
        if (this.pendingPageError) {
            this.addError(this.pendingPageError);
            this.pendingPageError = null;
            return true;
        }

        return false;
    }

    _createErrorAdapter(err, screenshotPath) {
        return new _formattableAdapter2.default(err, {
            userAgent: this.browserConnection.userAgent,
            screenshotPath: screenshotPath || '',
            testRunPhase: this.phase
        });
    }

    addError(err, screenshotPath) {
        const errList = err instanceof _errorList2.default ? err.items : [err];

        errList.forEach(item => {
            const adapter = this._createErrorAdapter(item, screenshotPath);

            this.errs.push(adapter);
        });
    }

    // Task queue
    _enqueueCommand(command, callsite) {
        var _this5 = this;

        if (this.pendingRequest) this._resolvePendingRequest(command);

        return new _pinkie2.default((() => {
            var _ref = (0, _asyncToGenerator3.default)(function* (resolve, reject) {
                _this5.addingDriverTasksCount--;
                _this5.driverTaskQueue.push({ command, resolve, reject, callsite });

                if (!_this5.addingDriverTasksCount) yield _this5.emit(ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT, _this5.driverTaskQueue.length);
            });

            return function (_x, _x2) {
                return _ref.apply(this, arguments);
            };
        })());
    }

    get driverTaskQueueLength() {
        return this.addingDriverTasksCount ? (0, _promisifyEvent2.default)(this, ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT) : _pinkie2.default.resolve(this.driverTaskQueue.length);
    }

    _enqueueBrowserConsoleMessagesCommand(command, callsite) {
        var _this6 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            yield _this6._enqueueCommand(command, callsite);

            return _this6.consoleMessages.getCopy();
        })();
    }

    _enqueueSetBreakpointCommand(callsite, error) {
        var _this7 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this7.browserConnection.isHeadlessBrowser()) {
                _this7.warningLog.addWarning(_warningMessage2.default.debugInHeadlessError);
                return;
            }

            _debugLogger2.default.showBreakpoint(_this7.session.id, _this7.browserConnection.userAgent, callsite, error);

            _this7.debugging = yield _this7.executeCommand(new serviceCommands.SetBreakpointCommand(!!error), callsite);
        })();
    }

    _removeAllNonServiceTasks() {
        this.driverTaskQueue = this.driverTaskQueue.filter(driverTask => (0, _utils.isServiceCommand)(driverTask.command));

        this.browserManipulationQueue.removeAllNonServiceManipulations();
    }

    // Current driver task
    get currentDriverTask() {
        return this.driverTaskQueue[0];
    }

    _resolveCurrentDriverTask(result) {
        this.currentDriverTask.resolve(result);
        this.driverTaskQueue.shift();

        if (this.testDoneCommandQueued) this._removeAllNonServiceTasks();
    }

    _rejectCurrentDriverTask(err) {
        err.callsite = err.callsite || this.currentDriverTask.callsite;
        err.isRejectedDriverTask = true;

        this.currentDriverTask.reject(err);
        this._removeAllNonServiceTasks();
    }

    // Pending request
    _clearPendingRequest() {
        if (this.pendingRequest) {
            clearTimeout(this.pendingRequest.responseTimeout);
            this.pendingRequest = null;
        }
    }

    _resolvePendingRequest(command) {
        this.lastDriverStatusResponse = command;
        this.pendingRequest.resolve(command);
        this._clearPendingRequest();
    }

    // Handle driver request
    _fulfillCurrentDriverTask(driverStatus) {
        if (driverStatus.executionError) this._rejectCurrentDriverTask(driverStatus.executionError);else this._resolveCurrentDriverTask(driverStatus.result);
    }

    _handlePageErrorStatus(pageError) {
        if (this.currentDriverTask && (0, _utils.isCommandRejectableByPageError)(this.currentDriverTask.command)) {
            this._rejectCurrentDriverTask(pageError);
            this.pendingPageError = null;

            return true;
        }

        this.pendingPageError = this.pendingPageError || pageError;

        return false;
    }

    _handleDriverRequest(driverStatus) {
        const isTestDone = this.currentDriverTask && this.currentDriverTask.command.type === _type2.default.testDone;
        const pageError = this.pendingPageError || driverStatus.pageError;
        const currentTaskRejectedByError = pageError && this._handlePageErrorStatus(pageError);

        if (this.disconnected) return new _pinkie2.default((_, reject) => reject());

        this.consoleMessages.concat(driverStatus.consoleMessages);

        if (!currentTaskRejectedByError && driverStatus.isCommandResult) {
            if (isTestDone) {
                this._resolveCurrentDriverTask();

                return TEST_DONE_CONFIRMATION_RESPONSE;
            }

            this._fulfillCurrentDriverTask(driverStatus);
        }

        return this._getCurrentDriverTaskCommand();
    }

    _getCurrentDriverTaskCommand() {
        if (!this.currentDriverTask) return null;

        const command = this.currentDriverTask.command;

        if (command.type === _type2.default.navigateTo && command.stateSnapshot) this.session.useStateSnapshot(JSON.parse(command.stateSnapshot));

        return command;
    }

    // Execute command
    _executeExpression(command) {
        var _this8 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const resultVariableName = command.resultVariableName,
                  isAsyncExpression = command.isAsyncExpression;


            let expression = command.expression;

            if (isAsyncExpression) expression = `await ${expression}`;

            if (resultVariableName) expression = `${resultVariableName} = ${expression}, ${resultVariableName}`;

            if (isAsyncExpression) expression = `(async () => { return ${expression}; }).apply(this);`;

            const result = executeJsExpression(expression, _this8, { skipVisibilityCheck: false });

            return isAsyncExpression ? yield result : result;
        })();
    }

    _executeAssertion(command, callsite) {
        var _this9 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const assertionTimeout = command.options.timeout === void 0 ? _this9.opts.assertionTimeout : command.options.timeout;
            const executor = new AssertionExecutor(command, assertionTimeout, callsite);

            executor.once('start-assertion-retries', function (timeout) {
                return _this9.executeCommand(new serviceCommands.ShowAssertionRetriesStatusCommand(timeout));
            });
            executor.once('end-assertion-retries', function (success) {
                return _this9.executeCommand(new serviceCommands.HideAssertionRetriesStatusCommand(success));
            });

            return executor.run();
        })();
    }

    _adjustConfigurationWithCommand(command) {
        if (command.type === _type2.default.testDone) {
            this.testDoneCommandQueued = true;
            _debugLogger2.default.hideBreakpoint(this.session.id);
        } else if (command.type === _type2.default.setNativeDialogHandler) this.activeDialogHandler = command.dialogHandler;else if (command.type === _type2.default.switchToIframe) this.activeIframeSelector = command.selector;else if (command.type === _type2.default.switchToMainWindow) this.activeIframeSelector = null;else if (command.type === _type2.default.setTestSpeed) this.speed = command.speed;else if (command.type === _type2.default.setPageLoadTimeout) this.pageLoadTimeout = command.duration;else if (command.type === _type2.default.debug) this.debugging = true;
    }

    _adjustScreenshotCommand(command) {
        var _this10 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const browserId = _this10.browserConnection.id;

            var _ref2 = yield _this10.browserConnection.provider.hasCustomActionForBrowser(browserId);

            const hasChromelessScreenshots = _ref2.hasChromelessScreenshots;


            if (!hasChromelessScreenshots) command.generateScreenshotMark();
        })();
    }

    _setBreakpointIfNecessary(command, callsite) {
        var _this11 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (!_this11.disableDebugBreakpoints && _this11.debugging && (0, _utils.canSetDebuggerBreakpointBeforeCommand)(command)) yield _this11._enqueueSetBreakpointCommand(callsite);
        })();
    }

    executeCommand(command, callsite) {
        var _this12 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this12.debugLog.command(command);

            if (_this12.pendingPageError && (0, _utils.isCommandRejectableByPageError)(command)) return _this12._rejectCommandWithPageError(callsite);

            if ((0, _utils.isExecutableOnClientCommand)(command)) _this12.addingDriverTasksCount++;

            _this12._adjustConfigurationWithCommand(command);

            yield _this12._setBreakpointIfNecessary(command, callsite);

            if ((0, _utils.isScreenshotCommand)(command)) yield _this12._adjustScreenshotCommand(command);

            if ((0, _utils.isBrowserManipulationCommand)(command)) _this12.browserManipulationQueue.push(command);

            if (command.type === _type2.default.wait) return (0, _delay2.default)(command.timeout);

            if (command.type === _type2.default.setPageLoadTimeout) return null;

            if (command.type === _type2.default.debug) return yield _this12._enqueueSetBreakpointCommand(callsite);

            if (command.type === _type2.default.useRole) return yield _this12._useRole(command.role, callsite);

            if (command.type === _type2.default.assertion) return _this12._executeAssertion(command, callsite);

            if (command.type === _type2.default.executeExpression) return yield _this12._executeExpression(command, callsite);

            if (command.type === _type2.default.getBrowserConsoleMessages) return yield _this12._enqueueBrowserConsoleMessagesCommand(command, callsite);

            return _this12._enqueueCommand(command, callsite);
        })();
    }

    _rejectCommandWithPageError(callsite) {
        const err = this.pendingPageError;

        err.callsite = callsite;
        this.pendingPageError = null;

        return _pinkie2.default.reject(err);
    }

    // Role management
    getStateSnapshot() {
        var _this13 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const state = _this13.session.getStateSnapshot();

            state.storages = yield _this13.executeCommand(new serviceCommands.BackupStoragesCommand());

            return state;
        })();
    }

    switchToCleanRun() {
        var _this14 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this14.ctx = (0, _create2.default)(null);
            _this14.fixtureCtx = (0, _create2.default)(null);
            _this14.consoleMessages = new _browserConsoleMessages2.default();

            _this14.session.useStateSnapshot(null);

            if (_this14.activeDialogHandler) {
                const removeDialogHandlerCommand = new actionCommands.SetNativeDialogHandlerCommand({ dialogHandler: { fn: null } });

                yield _this14.executeCommand(removeDialogHandlerCommand);
            }

            if (_this14.speed !== _this14.opts.speed) {
                const setSpeedCommand = new actionCommands.SetTestSpeedCommand({ speed: _this14.opts.speed });

                yield _this14.executeCommand(setSpeedCommand);
            }

            if (_this14.pageLoadTimeout !== _this14.opts.pageLoadTimeout) {
                const setPageLoadTimeoutCommand = new actionCommands.SetPageLoadTimeoutCommand({ duration: _this14.opts.pageLoadTimeout });

                yield _this14.executeCommand(setPageLoadTimeoutCommand);
            }
        })();
    }

    _getStateSnapshotFromRole(role) {
        var _this15 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const prevPhase = _this15.phase;

            _this15.phase = _phase2.default.inRoleInitializer;

            if (role.phase === _phase4.default.uninitialized) yield role.initialize(_this15);else if (role.phase === _phase4.default.pendingInitialization) yield (0, _promisifyEvent2.default)(role, 'initialized');

            if (role.initErr) throw role.initErr;

            _this15.phase = prevPhase;

            return role.stateSnapshot;
        })();
    }

    _useRole(role, callsite) {
        var _this16 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this16.phase === _phase2.default.inRoleInitializer) throw new _testRun.RoleSwitchInRoleInitializerError(callsite);

            _this16.disableDebugBreakpoints = true;

            const bookmark = new TestRunBookmark(_this16, role);

            yield bookmark.init();

            if (_this16.currentRoleId) _this16.usedRoleStates[_this16.currentRoleId] = yield _this16.getStateSnapshot();

            const stateSnapshot = _this16.usedRoleStates[role.id] || (yield _this16._getStateSnapshotFromRole(role));

            _this16.session.useStateSnapshot(stateSnapshot);

            _this16.currentRoleId = role.id;

            yield bookmark.restore(callsite, stateSnapshot);

            _this16.disableDebugBreakpoints = false;
        })();
    }

    // Get current URL
    getCurrentUrl() {
        var _this17 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const builder = new ClientFunctionBuilder(function () {
                /* eslint-disable no-undef */
                return window.location.href;
                /* eslint-enable no-undef */
            }, { boundTestRun: _this17 });

            const getLocation = builder.getFunction();

            return yield getLocation();
        })();
    }

    _disconnect(err) {
        this.disconnected = true;

        this._rejectCurrentDriverTask(err);

        this.emit('disconnected', err);

        delete _testRunTracker2.default.activeTestRuns[this.session.id];
    }
}

exports.default = TestRun; // Service message handlers

const ServiceMessages = TestRun.prototype;

// NOTE: this function is time-critical and must return ASAP to avoid client disconnection
ServiceMessages[_clientMessages2.default.ready] = function (msg) {
    this.debugLog.driverMessage(msg);

    this.emit('connected');

    this._clearPendingRequest();

    // NOTE: the driver sends the status for the second time if it didn't get a response at the
    // first try. This is possible when the page was unloaded after the driver sent the status.
    if (msg.status.id === this.lastDriverStatusId) return this.lastDriverStatusResponse;

    this.lastDriverStatusId = msg.status.id;
    this.lastDriverStatusResponse = this._handleDriverRequest(msg.status);

    if (this.lastDriverStatusResponse) return this.lastDriverStatusResponse;

    // NOTE: we send an empty response after the MAX_RESPONSE_DELAY timeout is exceeded to keep connection
    // with the client and prevent the response timeout exception on the client side
    const responseTimeout = setTimeout(() => this._resolvePendingRequest(null), MAX_RESPONSE_DELAY);

    return new _pinkie2.default((resolve, reject) => {
        this.pendingRequest = { resolve, reject, responseTimeout };
    });
};

ServiceMessages[_clientMessages2.default.readyForBrowserManipulation] = (() => {
    var _ref3 = (0, _asyncToGenerator3.default)(function* (msg) {
        this.debugLog.driverMessage(msg);

        let result = null;
        let error = null;

        try {
            result = yield this.browserManipulationQueue.executePendingManipulation(msg);
        } catch (err) {
            error = err;
        }

        return { result, error };
    });

    return function (_x3) {
        return _ref3.apply(this, arguments);
    };
})();

ServiceMessages[_clientMessages2.default.waitForFileDownload] = function (msg) {
    this.debugLog.driverMessage(msg);

    return new _pinkie2.default(resolve => {
        if (this.fileDownloadingHandled) {
            this.fileDownloadingHandled = false;
            resolve(true);
        } else this.resolveWaitForFileDownloadingPromise = resolve;
    });
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0LXJ1bi9pbmRleC5qcyJdLCJuYW1lcyI6WyJsYXp5UmVxdWlyZSIsInJlcXVpcmUiLCJTZXNzaW9uQ29udHJvbGxlciIsIkNsaWVudEZ1bmN0aW9uQnVpbGRlciIsImV4ZWN1dGVKc0V4cHJlc3Npb24iLCJCcm93c2VyTWFuaXB1bGF0aW9uUXVldWUiLCJUZXN0UnVuQm9va21hcmsiLCJBc3NlcnRpb25FeGVjdXRvciIsImFjdGlvbkNvbW1hbmRzIiwiYnJvd3Nlck1hbmlwdWxhdGlvbkNvbW1hbmRzIiwic2VydmljZUNvbW1hbmRzIiwiVEVTVF9SVU5fVEVNUExBVEUiLCJJRlJBTUVfVEVTVF9SVU5fVEVNUExBVEUiLCJURVNUX0RPTkVfQ09ORklSTUFUSU9OX1JFU1BPTlNFIiwiTUFYX1JFU1BPTlNFX0RFTEFZIiwiQUxMX0RSSVZFUl9UQVNLU19BRERFRF9UT19RVUVVRV9FVkVOVCIsIlRlc3RSdW4iLCJBc3luY0V2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwidGVzdCIsImJyb3dzZXJDb25uZWN0aW9uIiwic2NyZWVuc2hvdENhcHR1cmVyIiwiZ2xvYmFsV2FybmluZ0xvZyIsIm9wdHMiLCJ0ZXN0UnVuTWFya2VyIiwid2FybmluZ0xvZyIsIldhcm5pbmdMb2ciLCJwaGFzZSIsIlBIQVNFIiwiaW5pdGlhbCIsImRyaXZlclRhc2tRdWV1ZSIsInRlc3REb25lQ29tbWFuZFF1ZXVlZCIsImFjdGl2ZURpYWxvZ0hhbmRsZXIiLCJhY3RpdmVJZnJhbWVTZWxlY3RvciIsInNwZWVkIiwicGFnZUxvYWRUaW1lb3V0IiwiZGlzYWJsZVBhZ2VSZWxvYWRzIiwic2Vzc2lvbiIsImdldFNlc3Npb24iLCJjb25zb2xlTWVzc2FnZXMiLCJCcm93c2VyQ29uc29sZU1lc3NhZ2VzIiwicGVuZGluZ1JlcXVlc3QiLCJwZW5kaW5nUGFnZUVycm9yIiwiY29udHJvbGxlciIsImN0eCIsImZpeHR1cmVDdHgiLCJjdXJyZW50Um9sZUlkIiwidXNlZFJvbGVTdGF0ZXMiLCJlcnJzIiwibGFzdERyaXZlclN0YXR1c0lkIiwibGFzdERyaXZlclN0YXR1c1Jlc3BvbnNlIiwiZmlsZURvd25sb2FkaW5nSGFuZGxlZCIsInJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSIsImFkZGluZ0RyaXZlclRhc2tzQ291bnQiLCJkZWJ1Z2dpbmciLCJkZWJ1Z01vZGUiLCJkZWJ1Z09uRmFpbCIsImRpc2FibGVEZWJ1Z0JyZWFrcG9pbnRzIiwiZGVidWdSZXBvcnRlclBsdWdpbkhvc3QiLCJSZXBvcnRlclBsdWdpbkhvc3QiLCJub0NvbG9ycyIsImJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZSIsImRlYnVnTG9nIiwiVGVzdFJ1bkRlYnVnTG9nIiwidXNlckFnZW50IiwicXVhcmFudGluZSIsImluamVjdGFibGUiLCJzY3JpcHRzIiwicHVzaCIsInN0eWxlcyIsInJlcXVlc3RIb29rcyIsIl9pbml0UmVxdWVzdEhvb2tzIiwiaWQiLCJhZGRRdWFyYW50aW5lSW5mbyIsImFkZFJlcXVlc3RIb29rIiwiaG9vayIsImluZGV4T2YiLCJfaW5pdFJlcXVlc3RIb29rIiwicmVtb3ZlUmVxdWVzdEhvb2siLCJfZGlzcG9zZVJlcXVlc3RIb29rIiwiX2luc3RhbnRpYXRlUmVxdWVzdEZpbHRlclJ1bGVzIiwiX2luc3RhbnRpYXRlZFJlcXVlc3RGaWx0ZXJSdWxlcyIsImZvckVhY2giLCJydWxlIiwiYWRkUmVxdWVzdEV2ZW50TGlzdGVuZXJzIiwib25SZXF1ZXN0IiwiYmluZCIsIm9uQ29uZmlndXJlUmVzcG9uc2UiLCJfb25Db25maWd1cmVSZXNwb25zZSIsIm9uUmVzcG9uc2UiLCJyZW1vdmVSZXF1ZXN0RXZlbnRMaXN0ZW5lcnMiLCJfZ2V0UGF5bG9hZFNjcmlwdCIsIk11c3RhY2hlIiwicmVuZGVyIiwidGVzdFJ1bklkIiwiYnJvd3NlcklkIiwiYnJvd3NlckhlYXJ0YmVhdFJlbGF0aXZlVXJsIiwiaGVhcnRiZWF0UmVsYXRpdmVVcmwiLCJicm93c2VyU3RhdHVzUmVsYXRpdmVVcmwiLCJzdGF0dXNSZWxhdGl2ZVVybCIsImJyb3dzZXJTdGF0dXNEb25lUmVsYXRpdmVVcmwiLCJzdGF0dXNEb25lUmVsYXRpdmVVcmwiLCJ0ZXN0TmFtZSIsIm5hbWUiLCJmaXh0dXJlTmFtZSIsImZpeHR1cmUiLCJzZWxlY3RvclRpbWVvdXQiLCJza2lwSnNFcnJvcnMiLCJyZXRyeVRlc3RQYWdlcyIsImRpYWxvZ0hhbmRsZXIiLCJfZ2V0SWZyYW1lUGF5bG9hZFNjcmlwdCIsImdldEF1dGhDcmVkZW50aWFscyIsImF1dGhDcmVkZW50aWFscyIsImhhbmRsZUZpbGVEb3dubG9hZCIsImhhbmRsZVBhZ2VFcnJvciIsImVyciIsInJlcSIsImhlYWRlcnMiLCJVTlNUQUJMRV9ORVRXT1JLX01PREVfSEVBREVSIiwiY2xvc2VXaXRoRXJyb3IiLCJ0b1N0cmluZyIsIlBhZ2VMb2FkRXJyb3IiLCJyZXFPcHRzIiwidXJsIiwicmVkaXJlY3QiLCJ0b1Byb3h5VXJsIiwiX2V4ZWN1dGVUZXN0Rm4iLCJmbiIsInNjcmVlbnNob3RQYXRoIiwidGFrZVNjcmVlbnNob3RzT25GYWlscyIsImV4ZWN1dGVDb21tYW5kIiwiVGFrZVNjcmVlbnNob3RPbkZhaWxDb21tYW5kIiwiYWRkRXJyb3IiLCJfYWRkUGVuZGluZ1BhZ2VFcnJvcklmQW55IiwiX3J1bkJlZm9yZUhvb2siLCJiZWZvcmVGbiIsImluVGVzdEJlZm9yZUhvb2siLCJiZWZvcmVFYWNoRm4iLCJpbkZpeHR1cmVCZWZvcmVFYWNoSG9vayIsIl9ydW5BZnRlckhvb2siLCJhZnRlckZuIiwiaW5UZXN0QWZ0ZXJIb29rIiwiYWZ0ZXJFYWNoRm4iLCJpbkZpeHR1cmVBZnRlckVhY2hIb29rIiwic3RhcnQiLCJ0ZXN0UnVuVHJhY2tlciIsImFjdGl2ZVRlc3RSdW5zIiwiZW1pdCIsIm9uRGlzY29ubmVjdGVkIiwiX2Rpc2Nvbm5lY3QiLCJvbmNlIiwiaW5UZXN0IiwiZGlzY29ubmVjdGVkIiwicmVtb3ZlTGlzdGVuZXIiLCJsZW5ndGgiLCJfZW5xdWV1ZVNldEJyZWFrcG9pbnRDb21tYW5kIiwiZm9ybWF0RXJyb3IiLCJUZXN0RG9uZUNvbW1hbmQiLCJfY3JlYXRlRXJyb3JBZGFwdGVyIiwiVGVzdFJ1bkVycm9yRm9ybWF0dGFibGVBZGFwdGVyIiwidGVzdFJ1blBoYXNlIiwiZXJyTGlzdCIsIlRlc3RDYWZlRXJyb3JMaXN0IiwiaXRlbXMiLCJpdGVtIiwiYWRhcHRlciIsIl9lbnF1ZXVlQ29tbWFuZCIsImNvbW1hbmQiLCJjYWxsc2l0ZSIsIl9yZXNvbHZlUGVuZGluZ1JlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImRyaXZlclRhc2tRdWV1ZUxlbmd0aCIsIl9lbnF1ZXVlQnJvd3NlckNvbnNvbGVNZXNzYWdlc0NvbW1hbmQiLCJnZXRDb3B5IiwiZXJyb3IiLCJpc0hlYWRsZXNzQnJvd3NlciIsImFkZFdhcm5pbmciLCJXQVJOSU5HX01FU1NBR0UiLCJkZWJ1Z0luSGVhZGxlc3NFcnJvciIsImRlYnVnTG9nZ2VyIiwic2hvd0JyZWFrcG9pbnQiLCJTZXRCcmVha3BvaW50Q29tbWFuZCIsIl9yZW1vdmVBbGxOb25TZXJ2aWNlVGFza3MiLCJmaWx0ZXIiLCJkcml2ZXJUYXNrIiwicmVtb3ZlQWxsTm9uU2VydmljZU1hbmlwdWxhdGlvbnMiLCJjdXJyZW50RHJpdmVyVGFzayIsIl9yZXNvbHZlQ3VycmVudERyaXZlclRhc2siLCJyZXN1bHQiLCJzaGlmdCIsIl9yZWplY3RDdXJyZW50RHJpdmVyVGFzayIsImlzUmVqZWN0ZWREcml2ZXJUYXNrIiwiX2NsZWFyUGVuZGluZ1JlcXVlc3QiLCJjbGVhclRpbWVvdXQiLCJyZXNwb25zZVRpbWVvdXQiLCJfZnVsZmlsbEN1cnJlbnREcml2ZXJUYXNrIiwiZHJpdmVyU3RhdHVzIiwiZXhlY3V0aW9uRXJyb3IiLCJfaGFuZGxlUGFnZUVycm9yU3RhdHVzIiwicGFnZUVycm9yIiwiX2hhbmRsZURyaXZlclJlcXVlc3QiLCJpc1Rlc3REb25lIiwidHlwZSIsIkNPTU1BTkRfVFlQRSIsInRlc3REb25lIiwiY3VycmVudFRhc2tSZWplY3RlZEJ5RXJyb3IiLCJfIiwiY29uY2F0IiwiaXNDb21tYW5kUmVzdWx0IiwiX2dldEN1cnJlbnREcml2ZXJUYXNrQ29tbWFuZCIsIm5hdmlnYXRlVG8iLCJzdGF0ZVNuYXBzaG90IiwidXNlU3RhdGVTbmFwc2hvdCIsIkpTT04iLCJwYXJzZSIsIl9leGVjdXRlRXhwcmVzc2lvbiIsInJlc3VsdFZhcmlhYmxlTmFtZSIsImlzQXN5bmNFeHByZXNzaW9uIiwiZXhwcmVzc2lvbiIsInNraXBWaXNpYmlsaXR5Q2hlY2siLCJfZXhlY3V0ZUFzc2VydGlvbiIsImFzc2VydGlvblRpbWVvdXQiLCJvcHRpb25zIiwidGltZW91dCIsImV4ZWN1dG9yIiwiU2hvd0Fzc2VydGlvblJldHJpZXNTdGF0dXNDb21tYW5kIiwiSGlkZUFzc2VydGlvblJldHJpZXNTdGF0dXNDb21tYW5kIiwic3VjY2VzcyIsInJ1biIsIl9hZGp1c3RDb25maWd1cmF0aW9uV2l0aENvbW1hbmQiLCJoaWRlQnJlYWtwb2ludCIsInNldE5hdGl2ZURpYWxvZ0hhbmRsZXIiLCJzd2l0Y2hUb0lmcmFtZSIsInNlbGVjdG9yIiwic3dpdGNoVG9NYWluV2luZG93Iiwic2V0VGVzdFNwZWVkIiwic2V0UGFnZUxvYWRUaW1lb3V0IiwiZHVyYXRpb24iLCJkZWJ1ZyIsIl9hZGp1c3RTY3JlZW5zaG90Q29tbWFuZCIsInByb3ZpZGVyIiwiaGFzQ3VzdG9tQWN0aW9uRm9yQnJvd3NlciIsImhhc0Nocm9tZWxlc3NTY3JlZW5zaG90cyIsImdlbmVyYXRlU2NyZWVuc2hvdE1hcmsiLCJfc2V0QnJlYWtwb2ludElmTmVjZXNzYXJ5IiwiX3JlamVjdENvbW1hbmRXaXRoUGFnZUVycm9yIiwid2FpdCIsInVzZVJvbGUiLCJfdXNlUm9sZSIsInJvbGUiLCJhc3NlcnRpb24iLCJleGVjdXRlRXhwcmVzc2lvbiIsImdldEJyb3dzZXJDb25zb2xlTWVzc2FnZXMiLCJnZXRTdGF0ZVNuYXBzaG90Iiwic3RhdGUiLCJzdG9yYWdlcyIsIkJhY2t1cFN0b3JhZ2VzQ29tbWFuZCIsInN3aXRjaFRvQ2xlYW5SdW4iLCJyZW1vdmVEaWFsb2dIYW5kbGVyQ29tbWFuZCIsIlNldE5hdGl2ZURpYWxvZ0hhbmRsZXJDb21tYW5kIiwic2V0U3BlZWRDb21tYW5kIiwiU2V0VGVzdFNwZWVkQ29tbWFuZCIsInNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQiLCJTZXRQYWdlTG9hZFRpbWVvdXRDb21tYW5kIiwiX2dldFN0YXRlU25hcHNob3RGcm9tUm9sZSIsInByZXZQaGFzZSIsImluUm9sZUluaXRpYWxpemVyIiwiUk9MRV9QSEFTRSIsInVuaW5pdGlhbGl6ZWQiLCJpbml0aWFsaXplIiwicGVuZGluZ0luaXRpYWxpemF0aW9uIiwiaW5pdEVyciIsIlJvbGVTd2l0Y2hJblJvbGVJbml0aWFsaXplckVycm9yIiwiYm9va21hcmsiLCJpbml0IiwicmVzdG9yZSIsImdldEN1cnJlbnRVcmwiLCJidWlsZGVyIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwiYm91bmRUZXN0UnVuIiwiZ2V0TG9jYXRpb24iLCJnZXRGdW5jdGlvbiIsIlNlcnZpY2VNZXNzYWdlcyIsInByb3RvdHlwZSIsIkNMSUVOVF9NRVNTQUdFUyIsInJlYWR5IiwibXNnIiwiZHJpdmVyTWVzc2FnZSIsInN0YXR1cyIsInNldFRpbWVvdXQiLCJyZWFkeUZvckJyb3dzZXJNYW5pcHVsYXRpb24iLCJleGVjdXRlUGVuZGluZ01hbmlwdWxhdGlvbiIsIndhaXRGb3JGaWxlRG93bmxvYWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7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LDBCQUE5QixDQUF5REwsR0FBekQsQ0FBZjtBQUNILFNBRkQsQ0FHQSxPQUFPL0ssR0FBUCxFQUFZO0FBQ1I2RCxvQkFBUTdELEdBQVI7QUFDSDs7QUFFRCxlQUFPLEVBQUUyRSxNQUFGLEVBQVVkLEtBQVYsRUFBUDtBQUNILEtBZEQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZ0JBOEcsZ0JBQWdCRSx5QkFBZ0JRLG1CQUFoQyxJQUF1RCxVQUFVTixHQUFWLEVBQWU7QUFDbEUsU0FBS3BPLFFBQUwsQ0FBY3FPLGFBQWQsQ0FBNEJELEdBQTVCOztBQUVBLFdBQU8sSUFBSXhILGdCQUFKLENBQVlDLFdBQVc7QUFDMUIsWUFBSSxLQUFLeEgsc0JBQVQsRUFBaUM7QUFDN0IsaUJBQUtBLHNCQUFMLEdBQThCLEtBQTlCO0FBQ0F3SCxvQkFBUSxJQUFSO0FBQ0gsU0FIRCxNQUtJLEtBQUt2SCxvQ0FBTCxHQUE0Q3VILE9BQTVDO0FBQ1AsS0FQTSxDQUFQO0FBUUgsQ0FYRCIsImZpbGUiOiJ0ZXN0LXJ1bi9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHB1bGwgYXMgcmVtb3ZlIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHJlYWRTeW5jIGFzIHJlYWQgfSBmcm9tICdyZWFkLWZpbGUtcmVsYXRpdmUnO1xuaW1wb3J0IHByb21pc2lmeUV2ZW50IGZyb20gJ3Byb21pc2lmeS1ldmVudCc7XG5pbXBvcnQgUHJvbWlzZSBmcm9tICdwaW5raWUnO1xuaW1wb3J0IE11c3RhY2hlIGZyb20gJ211c3RhY2hlJztcbmltcG9ydCBBc3luY0V2ZW50RW1pdHRlciBmcm9tICcuLi91dGlscy9hc3luYy1ldmVudC1lbWl0dGVyJztcbmltcG9ydCBkZWJ1Z0xvZ2dlciBmcm9tICcuLi9ub3RpZmljYXRpb25zL2RlYnVnLWxvZ2dlcic7XG5pbXBvcnQgVGVzdFJ1bkRlYnVnTG9nIGZyb20gJy4vZGVidWctbG9nJztcbmltcG9ydCBUZXN0UnVuRXJyb3JGb3JtYXR0YWJsZUFkYXB0ZXIgZnJvbSAnLi4vZXJyb3JzL3Rlc3QtcnVuL2Zvcm1hdHRhYmxlLWFkYXB0ZXInO1xuaW1wb3J0IFRlc3RDYWZlRXJyb3JMaXN0IGZyb20gJy4uL2Vycm9ycy9lcnJvci1saXN0JztcbmltcG9ydCB7IFBhZ2VMb2FkRXJyb3IsIFJvbGVTd2l0Y2hJblJvbGVJbml0aWFsaXplckVycm9yIH0gZnJvbSAnLi4vZXJyb3JzL3Rlc3QtcnVuLyc7XG5pbXBvcnQgUEhBU0UgZnJvbSAnLi9waGFzZSc7XG5pbXBvcnQgQ0xJRU5UX01FU1NBR0VTIGZyb20gJy4vY2xpZW50LW1lc3NhZ2VzJztcbmltcG9ydCBDT01NQU5EX1RZUEUgZnJvbSAnLi9jb21tYW5kcy90eXBlJztcbmltcG9ydCBkZWxheSBmcm9tICcuLi91dGlscy9kZWxheSc7XG5pbXBvcnQgdGVzdFJ1bk1hcmtlciBmcm9tICcuL21hcmtlci1zeW1ib2wnO1xuaW1wb3J0IHRlc3RSdW5UcmFja2VyIGZyb20gJy4uL2FwaS90ZXN0LXJ1bi10cmFja2VyJztcbmltcG9ydCBST0xFX1BIQVNFIGZyb20gJy4uL3JvbGUvcGhhc2UnO1xuaW1wb3J0IFJlcG9ydGVyUGx1Z2luSG9zdCBmcm9tICcuLi9yZXBvcnRlci9wbHVnaW4taG9zdCc7XG5pbXBvcnQgQnJvd3NlckNvbnNvbGVNZXNzYWdlcyBmcm9tICcuL2Jyb3dzZXItY29uc29sZS1tZXNzYWdlcyc7XG5pbXBvcnQgeyBVTlNUQUJMRV9ORVRXT1JLX01PREVfSEVBREVSIH0gZnJvbSAnLi4vYnJvd3Nlci9jb25uZWN0aW9uL3Vuc3RhYmxlLW5ldHdvcmstbW9kZSc7XG5pbXBvcnQgV2FybmluZ0xvZyBmcm9tICcuLi9ub3RpZmljYXRpb25zL3dhcm5pbmctbG9nJztcbmltcG9ydCBXQVJOSU5HX01FU1NBR0UgZnJvbSAnLi4vbm90aWZpY2F0aW9ucy93YXJuaW5nLW1lc3NhZ2UnO1xuXG5pbXBvcnQge1xuICAgIGlzQ29tbWFuZFJlamVjdGFibGVCeVBhZ2VFcnJvcixcbiAgICBpc0Jyb3dzZXJNYW5pcHVsYXRpb25Db21tYW5kLFxuICAgIGlzU2NyZWVuc2hvdENvbW1hbmQsXG4gICAgaXNTZXJ2aWNlQ29tbWFuZCxcbiAgICBjYW5TZXREZWJ1Z2dlckJyZWFrcG9pbnRCZWZvcmVDb21tYW5kLFxuICAgIGlzRXhlY3V0YWJsZU9uQ2xpZW50Q29tbWFuZFxufSBmcm9tICcuL2NvbW1hbmRzL3V0aWxzJztcblxuY29uc3QgbGF6eVJlcXVpcmUgICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnaW1wb3J0LWxhenknKShyZXF1aXJlKTtcbmNvbnN0IFNlc3Npb25Db250cm9sbGVyICAgICAgICAgICA9IGxhenlSZXF1aXJlKCcuL3Nlc3Npb24tY29udHJvbGxlcicpO1xuY29uc3QgQ2xpZW50RnVuY3Rpb25CdWlsZGVyICAgICAgID0gbGF6eVJlcXVpcmUoJy4uL2NsaWVudC1mdW5jdGlvbnMvY2xpZW50LWZ1bmN0aW9uLWJ1aWxkZXInKTtcbmNvbnN0IGV4ZWN1dGVKc0V4cHJlc3Npb24gICAgICAgICA9IGxhenlSZXF1aXJlKCcuL2V4ZWN1dGUtanMtZXhwcmVzc2lvbicpO1xuY29uc3QgQnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlICAgID0gbGF6eVJlcXVpcmUoJy4vYnJvd3Nlci1tYW5pcHVsYXRpb24tcXVldWUnKTtcbmNvbnN0IFRlc3RSdW5Cb29rbWFyayAgICAgICAgICAgICA9IGxhenlSZXF1aXJlKCcuL2Jvb2ttYXJrJyk7XG5jb25zdCBBc3NlcnRpb25FeGVjdXRvciAgICAgICAgICAgPSBsYXp5UmVxdWlyZSgnLi4vYXNzZXJ0aW9ucy9leGVjdXRvcicpO1xuY29uc3QgYWN0aW9uQ29tbWFuZHMgICAgICAgICAgICAgID0gbGF6eVJlcXVpcmUoJy4vY29tbWFuZHMvYWN0aW9ucycpO1xuY29uc3QgYnJvd3Nlck1hbmlwdWxhdGlvbkNvbW1hbmRzID0gbGF6eVJlcXVpcmUoJy4vY29tbWFuZHMvYnJvd3Nlci1tYW5pcHVsYXRpb24nKTtcbmNvbnN0IHNlcnZpY2VDb21tYW5kcyAgICAgICAgICAgICA9IGxhenlSZXF1aXJlKCcuL2NvbW1hbmRzL3NlcnZpY2UnKTtcblxuXG5jb25zdCBURVNUX1JVTl9URU1QTEFURSAgICAgICAgICAgICAgID0gcmVhZCgnLi4vY2xpZW50L3Rlc3QtcnVuL2luZGV4LmpzLm11c3RhY2hlJyk7XG5jb25zdCBJRlJBTUVfVEVTVF9SVU5fVEVNUExBVEUgICAgICAgID0gcmVhZCgnLi4vY2xpZW50L3Rlc3QtcnVuL2lmcmFtZS5qcy5tdXN0YWNoZScpO1xuY29uc3QgVEVTVF9ET05FX0NPTkZJUk1BVElPTl9SRVNQT05TRSA9ICd0ZXN0LWRvbmUtY29uZmlybWF0aW9uJztcbmNvbnN0IE1BWF9SRVNQT05TRV9ERUxBWSAgICAgICAgICAgICAgPSAzMDAwO1xuXG5jb25zdCBBTExfRFJJVkVSX1RBU0tTX0FEREVEX1RPX1FVRVVFX0VWRU5UID0gJ2FsbC1kcml2ZXItdGFza3MtYWRkZWQtdG8tcXVldWUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXN0UnVuIGV4dGVuZHMgQXN5bmNFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yICh0ZXN0LCBicm93c2VyQ29ubmVjdGlvbiwgc2NyZWVuc2hvdENhcHR1cmVyLCBnbG9iYWxXYXJuaW5nTG9nLCBvcHRzKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpc1t0ZXN0UnVuTWFya2VyXSA9IHRydWU7XG5cbiAgICAgICAgdGhpcy53YXJuaW5nTG9nID0gbmV3IFdhcm5pbmdMb2coZ2xvYmFsV2FybmluZ0xvZyk7XG5cbiAgICAgICAgdGhpcy5vcHRzICAgICAgICAgICAgICA9IG9wdHM7XG4gICAgICAgIHRoaXMudGVzdCAgICAgICAgICAgICAgPSB0ZXN0O1xuICAgICAgICB0aGlzLmJyb3dzZXJDb25uZWN0aW9uID0gYnJvd3NlckNvbm5lY3Rpb247XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IFBIQVNFLmluaXRpYWw7XG5cbiAgICAgICAgdGhpcy5kcml2ZXJUYXNrUXVldWUgICAgICAgPSBbXTtcbiAgICAgICAgdGhpcy50ZXN0RG9uZUNvbW1hbmRRdWV1ZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmFjdGl2ZURpYWxvZ0hhbmRsZXIgID0gbnVsbDtcbiAgICAgICAgdGhpcy5hY3RpdmVJZnJhbWVTZWxlY3RvciA9IG51bGw7XG4gICAgICAgIHRoaXMuc3BlZWQgICAgICAgICAgICAgICAgPSB0aGlzLm9wdHMuc3BlZWQ7XG4gICAgICAgIHRoaXMucGFnZUxvYWRUaW1lb3V0ICAgICAgPSB0aGlzLm9wdHMucGFnZUxvYWRUaW1lb3V0O1xuXG4gICAgICAgIHRoaXMuZGlzYWJsZVBhZ2VSZWxvYWRzID0gdGVzdC5kaXNhYmxlUGFnZVJlbG9hZHMgfHwgb3B0cy5kaXNhYmxlUGFnZVJlbG9hZHMgJiYgdGVzdC5kaXNhYmxlUGFnZVJlbG9hZHMgIT09IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IFNlc3Npb25Db250cm9sbGVyLmdldFNlc3Npb24odGhpcyk7XG5cbiAgICAgICAgdGhpcy5jb25zb2xlTWVzc2FnZXMgPSBuZXcgQnJvd3NlckNvbnNvbGVNZXNzYWdlcygpO1xuXG4gICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3QgICA9IG51bGw7XG4gICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdHggICAgICAgID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5maXh0dXJlQ3R4ID0gbnVsbDtcblxuICAgICAgICB0aGlzLmN1cnJlbnRSb2xlSWQgID0gbnVsbDtcbiAgICAgICAgdGhpcy51c2VkUm9sZVN0YXRlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgICAgICAgdGhpcy5lcnJzID0gW107XG5cbiAgICAgICAgdGhpcy5sYXN0RHJpdmVyU3RhdHVzSWQgICAgICAgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5maWxlRG93bmxvYWRpbmdIYW5kbGVkICAgICAgICAgICAgICAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXNvbHZlV2FpdEZvckZpbGVEb3dubG9hZGluZ1Byb21pc2UgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuYWRkaW5nRHJpdmVyVGFza3NDb3VudCA9IDA7XG5cbiAgICAgICAgdGhpcy5kZWJ1Z2dpbmcgICAgICAgICAgICAgICA9IHRoaXMub3B0cy5kZWJ1Z01vZGU7XG4gICAgICAgIHRoaXMuZGVidWdPbkZhaWwgICAgICAgICAgICAgPSB0aGlzLm9wdHMuZGVidWdPbkZhaWw7XG4gICAgICAgIHRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kZWJ1Z1JlcG9ydGVyUGx1Z2luSG9zdCA9IG5ldyBSZXBvcnRlclBsdWdpbkhvc3QoeyBub0NvbG9yczogZmFsc2UgfSk7XG5cbiAgICAgICAgdGhpcy5icm93c2VyTWFuaXB1bGF0aW9uUXVldWUgPSBuZXcgQnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlKGJyb3dzZXJDb25uZWN0aW9uLCBzY3JlZW5zaG90Q2FwdHVyZXIsIHRoaXMud2FybmluZ0xvZyk7XG5cbiAgICAgICAgdGhpcy5kZWJ1Z0xvZyA9IG5ldyBUZXN0UnVuRGVidWdMb2codGhpcy5icm93c2VyQ29ubmVjdGlvbi51c2VyQWdlbnQpO1xuXG4gICAgICAgIHRoaXMucXVhcmFudGluZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5pbmplY3RhYmxlLnNjcmlwdHMucHVzaCgnL3Rlc3RjYWZlLWNvcmUuanMnKTtcbiAgICAgICAgdGhpcy5pbmplY3RhYmxlLnNjcmlwdHMucHVzaCgnL3Rlc3RjYWZlLXVpLmpzJyk7XG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zY3JpcHRzLnB1c2goJy90ZXN0Y2FmZS1hdXRvbWF0aW9uLmpzJyk7XG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zY3JpcHRzLnB1c2goJy90ZXN0Y2FmZS1kcml2ZXIuanMnKTtcbiAgICAgICAgdGhpcy5pbmplY3RhYmxlLnN0eWxlcy5wdXNoKCcvdGVzdGNhZmUtdWktc3R5bGVzLmNzcycpO1xuXG4gICAgICAgIHRoaXMucmVxdWVzdEhvb2tzID0gQXJyYXkuZnJvbSh0aGlzLnRlc3QucmVxdWVzdEhvb2tzKTtcblxuICAgICAgICB0aGlzLl9pbml0UmVxdWVzdEhvb2tzKCk7XG4gICAgfVxuXG4gICAgZ2V0IGlkICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5pZDtcbiAgICB9XG5cbiAgICBnZXQgaW5qZWN0YWJsZSAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb24uaW5qZWN0YWJsZTtcbiAgICB9XG5cbiAgICBhZGRRdWFyYW50aW5lSW5mbyAocXVhcmFudGluZSkge1xuICAgICAgICB0aGlzLnF1YXJhbnRpbmUgPSBxdWFyYW50aW5lO1xuICAgIH1cblxuICAgIGFkZFJlcXVlc3RIb29rIChob29rKSB7XG4gICAgICAgIGlmICh0aGlzLnJlcXVlc3RIb29rcy5pbmRleE9mKGhvb2spICE9PSAtMSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB0aGlzLnJlcXVlc3RIb29rcy5wdXNoKGhvb2spO1xuICAgICAgICB0aGlzLl9pbml0UmVxdWVzdEhvb2soaG9vayk7XG4gICAgfVxuXG4gICAgcmVtb3ZlUmVxdWVzdEhvb2sgKGhvb2spIHtcbiAgICAgICAgaWYgKHRoaXMucmVxdWVzdEhvb2tzLmluZGV4T2YoaG9vaykgPT09IC0xKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHJlbW92ZSh0aGlzLnJlcXVlc3RIb29rcywgaG9vayk7XG4gICAgICAgIHRoaXMuX2Rpc3Bvc2VSZXF1ZXN0SG9vayhob29rKTtcbiAgICB9XG5cbiAgICBfaW5pdFJlcXVlc3RIb29rIChob29rKSB7XG4gICAgICAgIGhvb2sud2FybmluZ0xvZyA9IHRoaXMud2FybmluZ0xvZztcblxuICAgICAgICBob29rLl9pbnN0YW50aWF0ZVJlcXVlc3RGaWx0ZXJSdWxlcygpO1xuICAgICAgICBob29rLl9pbnN0YW50aWF0ZWRSZXF1ZXN0RmlsdGVyUnVsZXMuZm9yRWFjaChydWxlID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5hZGRSZXF1ZXN0RXZlbnRMaXN0ZW5lcnMocnVsZSwge1xuICAgICAgICAgICAgICAgIG9uUmVxdWVzdDogICAgICAgICAgIGhvb2sub25SZXF1ZXN0LmJpbmQoaG9vayksXG4gICAgICAgICAgICAgICAgb25Db25maWd1cmVSZXNwb25zZTogaG9vay5fb25Db25maWd1cmVSZXNwb25zZS5iaW5kKGhvb2spLFxuICAgICAgICAgICAgICAgIG9uUmVzcG9uc2U6ICAgICAgICAgIGhvb2sub25SZXNwb25zZS5iaW5kKGhvb2spXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2Rpc3Bvc2VSZXF1ZXN0SG9vayAoaG9vaykge1xuICAgICAgICBob29rLndhcm5pbmdMb2cgPSBudWxsO1xuXG4gICAgICAgIGhvb2suX2luc3RhbnRpYXRlZFJlcXVlc3RGaWx0ZXJSdWxlcy5mb3JFYWNoKHJ1bGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXNzaW9uLnJlbW92ZVJlcXVlc3RFdmVudExpc3RlbmVycyhydWxlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2luaXRSZXF1ZXN0SG9va3MgKCkge1xuICAgICAgICB0aGlzLnJlcXVlc3RIb29rcy5mb3JFYWNoKGhvb2sgPT4gdGhpcy5faW5pdFJlcXVlc3RIb29rKGhvb2spKTtcbiAgICB9XG5cbiAgICAvLyBIYW1tZXJoZWFkIHBheWxvYWRcbiAgICBfZ2V0UGF5bG9hZFNjcmlwdCAoKSB7XG4gICAgICAgIHRoaXMuZmlsZURvd25sb2FkaW5nSGFuZGxlZCAgICAgICAgICAgICAgID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVzb2x2ZVdhaXRGb3JGaWxlRG93bmxvYWRpbmdQcm9taXNlID0gbnVsbDtcblxuICAgICAgICByZXR1cm4gTXVzdGFjaGUucmVuZGVyKFRFU1RfUlVOX1RFTVBMQVRFLCB7XG4gICAgICAgICAgICB0ZXN0UnVuSWQ6ICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnNlc3Npb24uaWQpLFxuICAgICAgICAgICAgYnJvd3NlcklkOiAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5icm93c2VyQ29ubmVjdGlvbi5pZCksXG4gICAgICAgICAgICBicm93c2VySGVhcnRiZWF0UmVsYXRpdmVVcmw6ICBKU09OLnN0cmluZ2lmeSh0aGlzLmJyb3dzZXJDb25uZWN0aW9uLmhlYXJ0YmVhdFJlbGF0aXZlVXJsKSxcbiAgICAgICAgICAgIGJyb3dzZXJTdGF0dXNSZWxhdGl2ZVVybDogICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuYnJvd3NlckNvbm5lY3Rpb24uc3RhdHVzUmVsYXRpdmVVcmwpLFxuICAgICAgICAgICAgYnJvd3NlclN0YXR1c0RvbmVSZWxhdGl2ZVVybDogSlNPTi5zdHJpbmdpZnkodGhpcy5icm93c2VyQ29ubmVjdGlvbi5zdGF0dXNEb25lUmVsYXRpdmVVcmwpLFxuICAgICAgICAgICAgdXNlckFnZW50OiAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5icm93c2VyQ29ubmVjdGlvbi51c2VyQWdlbnQpLFxuICAgICAgICAgICAgdGVzdE5hbWU6ICAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy50ZXN0Lm5hbWUpLFxuICAgICAgICAgICAgZml4dHVyZU5hbWU6ICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy50ZXN0LmZpeHR1cmUubmFtZSksXG4gICAgICAgICAgICBzZWxlY3RvclRpbWVvdXQ6ICAgICAgICAgICAgICB0aGlzLm9wdHMuc2VsZWN0b3JUaW1lb3V0LFxuICAgICAgICAgICAgcGFnZUxvYWRUaW1lb3V0OiAgICAgICAgICAgICAgdGhpcy5wYWdlTG9hZFRpbWVvdXQsXG4gICAgICAgICAgICBza2lwSnNFcnJvcnM6ICAgICAgICAgICAgICAgICB0aGlzLm9wdHMuc2tpcEpzRXJyb3JzLFxuICAgICAgICAgICAgcmV0cnlUZXN0UGFnZXM6ICAgICAgICAgICAgICAgISF0aGlzLm9wdHMucmV0cnlUZXN0UGFnZXMsXG4gICAgICAgICAgICBzcGVlZDogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWVkLFxuICAgICAgICAgICAgZGlhbG9nSGFuZGxlcjogICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3RpdmVEaWFsb2dIYW5kbGVyKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfZ2V0SWZyYW1lUGF5bG9hZFNjcmlwdCAoKSB7XG4gICAgICAgIHJldHVybiBNdXN0YWNoZS5yZW5kZXIoSUZSQU1FX1RFU1RfUlVOX1RFTVBMQVRFLCB7XG4gICAgICAgICAgICB0ZXN0UnVuSWQ6ICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuc2Vzc2lvbi5pZCksXG4gICAgICAgICAgICBzZWxlY3RvclRpbWVvdXQ6IHRoaXMub3B0cy5zZWxlY3RvclRpbWVvdXQsXG4gICAgICAgICAgICBwYWdlTG9hZFRpbWVvdXQ6IHRoaXMucGFnZUxvYWRUaW1lb3V0LFxuICAgICAgICAgICAgcmV0cnlUZXN0UGFnZXM6ICAhIXRoaXMub3B0cy5yZXRyeVRlc3RQYWdlcyxcbiAgICAgICAgICAgIHNwZWVkOiAgICAgICAgICAgdGhpcy5zcGVlZCxcbiAgICAgICAgICAgIGRpYWxvZ0hhbmRsZXI6ICAgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3RpdmVEaWFsb2dIYW5kbGVyKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBIYW1tZXJoZWFkIGhhbmRsZXJzXG4gICAgZ2V0QXV0aENyZWRlbnRpYWxzICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGVzdC5hdXRoQ3JlZGVudGlhbHM7XG4gICAgfVxuXG4gICAgaGFuZGxlRmlsZURvd25sb2FkICgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzb2x2ZVdhaXRGb3JGaWxlRG93bmxvYWRpbmdQcm9taXNlKSB7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSh0cnVlKTtcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZVdhaXRGb3JGaWxlRG93bmxvYWRpbmdQcm9taXNlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmZpbGVEb3dubG9hZGluZ0hhbmRsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGhhbmRsZVBhZ2VFcnJvciAoY3R4LCBlcnIpIHtcbiAgICAgICAgaWYgKGN0eC5yZXEuaGVhZGVyc1tVTlNUQUJMRV9ORVRXT1JLX01PREVfSEVBREVSXSkge1xuICAgICAgICAgICAgY3R4LmNsb3NlV2l0aEVycm9yKDUwMCwgZXJyLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wZW5kaW5nUGFnZUVycm9yID0gbmV3IFBhZ2VMb2FkRXJyb3IoZXJyLCBjdHgucmVxT3B0cy51cmwpO1xuXG4gICAgICAgIGN0eC5yZWRpcmVjdChjdHgudG9Qcm94eVVybCgnYWJvdXQ6ZXJyb3InKSk7XG4gICAgfVxuXG4gICAgLy8gVGVzdCBmdW5jdGlvbiBleGVjdXRpb25cbiAgICBhc3luYyBfZXhlY3V0ZVRlc3RGbiAocGhhc2UsIGZuKSB7XG4gICAgICAgIHRoaXMucGhhc2UgPSBwaGFzZTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgZm4odGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbGV0IHNjcmVlbnNob3RQYXRoID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0cy50YWtlU2NyZWVuc2hvdHNPbkZhaWxzKVxuICAgICAgICAgICAgICAgIHNjcmVlbnNob3RQYXRoID0gYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZChuZXcgYnJvd3Nlck1hbmlwdWxhdGlvbkNvbW1hbmRzLlRha2VTY3JlZW5zaG90T25GYWlsQ29tbWFuZCgpKTtcblxuICAgICAgICAgICAgdGhpcy5hZGRFcnJvcihlcnIsIHNjcmVlbnNob3RQYXRoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAhdGhpcy5fYWRkUGVuZGluZ1BhZ2VFcnJvcklmQW55KCk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3J1bkJlZm9yZUhvb2sgKCkge1xuICAgICAgICBpZiAodGhpcy50ZXN0LmJlZm9yZUZuKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2V4ZWN1dGVUZXN0Rm4oUEhBU0UuaW5UZXN0QmVmb3JlSG9vaywgdGhpcy50ZXN0LmJlZm9yZUZuKTtcblxuICAgICAgICBpZiAodGhpcy50ZXN0LmZpeHR1cmUuYmVmb3JlRWFjaEZuKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2V4ZWN1dGVUZXN0Rm4oUEhBU0UuaW5GaXh0dXJlQmVmb3JlRWFjaEhvb2ssIHRoaXMudGVzdC5maXh0dXJlLmJlZm9yZUVhY2hGbik7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgYXN5bmMgX3J1bkFmdGVySG9vayAoKSB7XG4gICAgICAgIGlmICh0aGlzLnRlc3QuYWZ0ZXJGbilcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9leGVjdXRlVGVzdEZuKFBIQVNFLmluVGVzdEFmdGVySG9vaywgdGhpcy50ZXN0LmFmdGVyRm4pO1xuXG4gICAgICAgIGlmICh0aGlzLnRlc3QuZml4dHVyZS5hZnRlckVhY2hGbilcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9leGVjdXRlVGVzdEZuKFBIQVNFLmluRml4dHVyZUFmdGVyRWFjaEhvb2ssIHRoaXMudGVzdC5maXh0dXJlLmFmdGVyRWFjaEZuKTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBhc3luYyBzdGFydCAoKSB7XG4gICAgICAgIHRlc3RSdW5UcmFja2VyLmFjdGl2ZVRlc3RSdW5zW3RoaXMuc2Vzc2lvbi5pZF0gPSB0aGlzO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZW1pdCgnc3RhcnQnKTtcblxuICAgICAgICBjb25zdCBvbkRpc2Nvbm5lY3RlZCA9IGVyciA9PiB0aGlzLl9kaXNjb25uZWN0KGVycik7XG5cbiAgICAgICAgdGhpcy5icm93c2VyQ29ubmVjdGlvbi5vbmNlKCdkaXNjb25uZWN0ZWQnLCBvbkRpc2Nvbm5lY3RlZCk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5vbmNlKCdjb25uZWN0ZWQnKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmVtaXQoJ3JlYWR5Jyk7XG5cbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuX3J1bkJlZm9yZUhvb2soKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5fZXhlY3V0ZVRlc3RGbihQSEFTRS5pblRlc3QsIHRoaXMudGVzdC5mbik7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9ydW5BZnRlckhvb2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRpc2Nvbm5lY3RlZClcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB0aGlzLmJyb3dzZXJDb25uZWN0aW9uLnJlbW92ZUxpc3RlbmVyKCdkaXNjb25uZWN0ZWQnLCBvbkRpc2Nvbm5lY3RlZCk7XG5cbiAgICAgICAgaWYgKHRoaXMuZXJycy5sZW5ndGggJiYgdGhpcy5kZWJ1Z09uRmFpbClcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2VucXVldWVTZXRCcmVha3BvaW50Q29tbWFuZChudWxsLCB0aGlzLmRlYnVnUmVwb3J0ZXJQbHVnaW5Ib3N0LmZvcm1hdEVycm9yKHRoaXMuZXJyc1swXSkpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZW1pdCgnYmVmb3JlLWRvbmUnKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBzZXJ2aWNlQ29tbWFuZHMuVGVzdERvbmVDb21tYW5kKCkpO1xuXG4gICAgICAgIHRoaXMuX2FkZFBlbmRpbmdQYWdlRXJyb3JJZkFueSgpO1xuXG4gICAgICAgIGRlbGV0ZSB0ZXN0UnVuVHJhY2tlci5hY3RpdmVUZXN0UnVuc1t0aGlzLnNlc3Npb24uaWRdO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZW1pdCgnZG9uZScpO1xuICAgIH1cblxuICAgIC8vIEVycm9yc1xuICAgIF9hZGRQZW5kaW5nUGFnZUVycm9ySWZBbnkgKCkge1xuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUGFnZUVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmFkZEVycm9yKHRoaXMucGVuZGluZ1BhZ2VFcnJvcik7XG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUVycm9yQWRhcHRlciAoZXJyLCBzY3JlZW5zaG90UGF0aCkge1xuICAgICAgICByZXR1cm4gbmV3IFRlc3RSdW5FcnJvckZvcm1hdHRhYmxlQWRhcHRlcihlcnIsIHtcbiAgICAgICAgICAgIHVzZXJBZ2VudDogICAgICB0aGlzLmJyb3dzZXJDb25uZWN0aW9uLnVzZXJBZ2VudCxcbiAgICAgICAgICAgIHNjcmVlbnNob3RQYXRoOiBzY3JlZW5zaG90UGF0aCB8fCAnJyxcbiAgICAgICAgICAgIHRlc3RSdW5QaGFzZTogICB0aGlzLnBoYXNlXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFkZEVycm9yIChlcnIsIHNjcmVlbnNob3RQYXRoKSB7XG4gICAgICAgIGNvbnN0IGVyckxpc3QgPSBlcnIgaW5zdGFuY2VvZiBUZXN0Q2FmZUVycm9yTGlzdCA/IGVyci5pdGVtcyA6IFtlcnJdO1xuXG4gICAgICAgIGVyckxpc3QuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFkYXB0ZXIgPSB0aGlzLl9jcmVhdGVFcnJvckFkYXB0ZXIoaXRlbSwgc2NyZWVuc2hvdFBhdGgpO1xuXG4gICAgICAgICAgICB0aGlzLmVycnMucHVzaChhZGFwdGVyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVGFzayBxdWV1ZVxuICAgIF9lbnF1ZXVlQ29tbWFuZCAoY29tbWFuZCwgY2FsbHNpdGUpIHtcbiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1JlcXVlc3QpXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlUGVuZGluZ1JlcXVlc3QoY29tbWFuZCk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWRkaW5nRHJpdmVyVGFza3NDb3VudC0tO1xuICAgICAgICAgICAgdGhpcy5kcml2ZXJUYXNrUXVldWUucHVzaCh7IGNvbW1hbmQsIHJlc29sdmUsIHJlamVjdCwgY2FsbHNpdGUgfSk7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5hZGRpbmdEcml2ZXJUYXNrc0NvdW50KVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZW1pdChBTExfRFJJVkVSX1RBU0tTX0FEREVEX1RPX1FVRVVFX0VWRU5ULCB0aGlzLmRyaXZlclRhc2tRdWV1ZS5sZW5ndGgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXQgZHJpdmVyVGFza1F1ZXVlTGVuZ3RoICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkaW5nRHJpdmVyVGFza3NDb3VudCA/IHByb21pc2lmeUV2ZW50KHRoaXMsIEFMTF9EUklWRVJfVEFTS1NfQURERURfVE9fUVVFVUVfRVZFTlQpIDogUHJvbWlzZS5yZXNvbHZlKHRoaXMuZHJpdmVyVGFza1F1ZXVlLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgYXN5bmMgX2VucXVldWVCcm93c2VyQ29uc29sZU1lc3NhZ2VzQ29tbWFuZCAoY29tbWFuZCwgY2FsbHNpdGUpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5fZW5xdWV1ZUNvbW1hbmQoY29tbWFuZCwgY2FsbHNpdGUpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmNvbnNvbGVNZXNzYWdlcy5nZXRDb3B5KCk7XG4gICAgfVxuXG4gICAgYXN5bmMgX2VucXVldWVTZXRCcmVha3BvaW50Q29tbWFuZCAoY2FsbHNpdGUsIGVycm9yKSB7XG4gICAgICAgIGlmICh0aGlzLmJyb3dzZXJDb25uZWN0aW9uLmlzSGVhZGxlc3NCcm93c2VyKCkpIHtcbiAgICAgICAgICAgIHRoaXMud2FybmluZ0xvZy5hZGRXYXJuaW5nKFdBUk5JTkdfTUVTU0FHRS5kZWJ1Z0luSGVhZGxlc3NFcnJvcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBkZWJ1Z0xvZ2dlci5zaG93QnJlYWtwb2ludCh0aGlzLnNlc3Npb24uaWQsIHRoaXMuYnJvd3NlckNvbm5lY3Rpb24udXNlckFnZW50LCBjYWxsc2l0ZSwgZXJyb3IpO1xuXG4gICAgICAgIHRoaXMuZGVidWdnaW5nID0gYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZChuZXcgc2VydmljZUNvbW1hbmRzLlNldEJyZWFrcG9pbnRDb21tYW5kKCEhZXJyb3IpLCBjYWxsc2l0ZSk7XG4gICAgfVxuXG4gICAgX3JlbW92ZUFsbE5vblNlcnZpY2VUYXNrcyAoKSB7XG4gICAgICAgIHRoaXMuZHJpdmVyVGFza1F1ZXVlID0gdGhpcy5kcml2ZXJUYXNrUXVldWUuZmlsdGVyKGRyaXZlclRhc2sgPT4gaXNTZXJ2aWNlQ29tbWFuZChkcml2ZXJUYXNrLmNvbW1hbmQpKTtcblxuICAgICAgICB0aGlzLmJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZS5yZW1vdmVBbGxOb25TZXJ2aWNlTWFuaXB1bGF0aW9ucygpO1xuICAgIH1cblxuICAgIC8vIEN1cnJlbnQgZHJpdmVyIHRhc2tcbiAgICBnZXQgY3VycmVudERyaXZlclRhc2sgKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kcml2ZXJUYXNrUXVldWVbMF07XG4gICAgfVxuXG4gICAgX3Jlc29sdmVDdXJyZW50RHJpdmVyVGFzayAocmVzdWx0KSB7XG4gICAgICAgIHRoaXMuY3VycmVudERyaXZlclRhc2sucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICB0aGlzLmRyaXZlclRhc2tRdWV1ZS5zaGlmdCgpO1xuXG4gICAgICAgIGlmICh0aGlzLnRlc3REb25lQ29tbWFuZFF1ZXVlZClcbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZUFsbE5vblNlcnZpY2VUYXNrcygpO1xuICAgIH1cblxuICAgIF9yZWplY3RDdXJyZW50RHJpdmVyVGFzayAoZXJyKSB7XG4gICAgICAgIGVyci5jYWxsc2l0ZSAgICAgICAgICAgICA9IGVyci5jYWxsc2l0ZSB8fCB0aGlzLmN1cnJlbnREcml2ZXJUYXNrLmNhbGxzaXRlO1xuICAgICAgICBlcnIuaXNSZWplY3RlZERyaXZlclRhc2sgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMuY3VycmVudERyaXZlclRhc2sucmVqZWN0KGVycik7XG4gICAgICAgIHRoaXMuX3JlbW92ZUFsbE5vblNlcnZpY2VUYXNrcygpO1xuICAgIH1cblxuICAgIC8vIFBlbmRpbmcgcmVxdWVzdFxuICAgIF9jbGVhclBlbmRpbmdSZXF1ZXN0ICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1JlcXVlc3QpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnBlbmRpbmdSZXF1ZXN0LnJlc3BvbnNlVGltZW91dCk7XG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9yZXNvbHZlUGVuZGluZ1JlcXVlc3QgKGNvbW1hbmQpIHtcbiAgICAgICAgdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2UgPSBjb21tYW5kO1xuICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0LnJlc29sdmUoY29tbWFuZCk7XG4gICAgICAgIHRoaXMuX2NsZWFyUGVuZGluZ1JlcXVlc3QoKTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZHJpdmVyIHJlcXVlc3RcbiAgICBfZnVsZmlsbEN1cnJlbnREcml2ZXJUYXNrIChkcml2ZXJTdGF0dXMpIHtcbiAgICAgICAgaWYgKGRyaXZlclN0YXR1cy5leGVjdXRpb25FcnJvcilcbiAgICAgICAgICAgIHRoaXMuX3JlamVjdEN1cnJlbnREcml2ZXJUYXNrKGRyaXZlclN0YXR1cy5leGVjdXRpb25FcnJvcik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVDdXJyZW50RHJpdmVyVGFzayhkcml2ZXJTdGF0dXMucmVzdWx0KTtcbiAgICB9XG5cbiAgICBfaGFuZGxlUGFnZUVycm9yU3RhdHVzIChwYWdlRXJyb3IpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudERyaXZlclRhc2sgJiYgaXNDb21tYW5kUmVqZWN0YWJsZUJ5UGFnZUVycm9yKHRoaXMuY3VycmVudERyaXZlclRhc2suY29tbWFuZCkpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlamVjdEN1cnJlbnREcml2ZXJUYXNrKHBhZ2VFcnJvcik7XG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgPSBudWxsO1xuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IHRoaXMucGVuZGluZ1BhZ2VFcnJvciB8fCBwYWdlRXJyb3I7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIF9oYW5kbGVEcml2ZXJSZXF1ZXN0IChkcml2ZXJTdGF0dXMpIHtcbiAgICAgICAgY29uc3QgaXNUZXN0RG9uZSAgICAgICAgICAgICAgICAgPSB0aGlzLmN1cnJlbnREcml2ZXJUYXNrICYmIHRoaXMuY3VycmVudERyaXZlclRhc2suY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUudGVzdERvbmU7XG4gICAgICAgIGNvbnN0IHBhZ2VFcnJvciAgICAgICAgICAgICAgICAgID0gdGhpcy5wZW5kaW5nUGFnZUVycm9yIHx8IGRyaXZlclN0YXR1cy5wYWdlRXJyb3I7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUYXNrUmVqZWN0ZWRCeUVycm9yID0gcGFnZUVycm9yICYmIHRoaXMuX2hhbmRsZVBhZ2VFcnJvclN0YXR1cyhwYWdlRXJyb3IpO1xuXG4gICAgICAgIGlmICh0aGlzLmRpc2Nvbm5lY3RlZClcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgoXywgcmVqZWN0KSA9PiByZWplY3QoKSk7XG5cbiAgICAgICAgdGhpcy5jb25zb2xlTWVzc2FnZXMuY29uY2F0KGRyaXZlclN0YXR1cy5jb25zb2xlTWVzc2FnZXMpO1xuXG4gICAgICAgIGlmICghY3VycmVudFRhc2tSZWplY3RlZEJ5RXJyb3IgJiYgZHJpdmVyU3RhdHVzLmlzQ29tbWFuZFJlc3VsdCkge1xuICAgICAgICAgICAgaWYgKGlzVGVzdERvbmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXNvbHZlQ3VycmVudERyaXZlclRhc2soKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBURVNUX0RPTkVfQ09ORklSTUFUSU9OX1JFU1BPTlNFO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9mdWxmaWxsQ3VycmVudERyaXZlclRhc2soZHJpdmVyU3RhdHVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRDdXJyZW50RHJpdmVyVGFza0NvbW1hbmQoKTtcbiAgICB9XG5cbiAgICBfZ2V0Q3VycmVudERyaXZlclRhc2tDb21tYW5kICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnREcml2ZXJUYXNrKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY29uc3QgY29tbWFuZCA9IHRoaXMuY3VycmVudERyaXZlclRhc2suY29tbWFuZDtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUubmF2aWdhdGVUbyAmJiBjb21tYW5kLnN0YXRlU25hcHNob3QpXG4gICAgICAgICAgICB0aGlzLnNlc3Npb24udXNlU3RhdGVTbmFwc2hvdChKU09OLnBhcnNlKGNvbW1hbmQuc3RhdGVTbmFwc2hvdCkpO1xuXG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgY29tbWFuZFxuICAgIGFzeW5jIF9leGVjdXRlRXhwcmVzc2lvbiAoY29tbWFuZCkge1xuICAgICAgICBjb25zdCB7IHJlc3VsdFZhcmlhYmxlTmFtZSwgaXNBc3luY0V4cHJlc3Npb24gfSA9IGNvbW1hbmQ7XG5cbiAgICAgICAgbGV0IGV4cHJlc3Npb24gPSBjb21tYW5kLmV4cHJlc3Npb247XG5cbiAgICAgICAgaWYgKGlzQXN5bmNFeHByZXNzaW9uKVxuICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGBhd2FpdCAke2V4cHJlc3Npb259YDtcblxuICAgICAgICBpZiAocmVzdWx0VmFyaWFibGVOYW1lKVxuICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGAke3Jlc3VsdFZhcmlhYmxlTmFtZX0gPSAke2V4cHJlc3Npb259LCAke3Jlc3VsdFZhcmlhYmxlTmFtZX1gO1xuXG4gICAgICAgIGlmIChpc0FzeW5jRXhwcmVzc2lvbilcbiAgICAgICAgICAgIGV4cHJlc3Npb24gPSBgKGFzeW5jICgpID0+IHsgcmV0dXJuICR7ZXhwcmVzc2lvbn07IH0pLmFwcGx5KHRoaXMpO2A7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZXhlY3V0ZUpzRXhwcmVzc2lvbihleHByZXNzaW9uLCB0aGlzLCB7IHNraXBWaXNpYmlsaXR5Q2hlY2s6IGZhbHNlIH0pO1xuXG4gICAgICAgIHJldHVybiBpc0FzeW5jRXhwcmVzc2lvbiA/IGF3YWl0IHJlc3VsdCA6IHJlc3VsdDtcbiAgICB9XG5cbiAgICBhc3luYyBfZXhlY3V0ZUFzc2VydGlvbiAoY29tbWFuZCwgY2FsbHNpdGUpIHtcbiAgICAgICAgY29uc3QgYXNzZXJ0aW9uVGltZW91dCA9IGNvbW1hbmQub3B0aW9ucy50aW1lb3V0ID09PSB2b2lkIDAgPyB0aGlzLm9wdHMuYXNzZXJ0aW9uVGltZW91dCA6IGNvbW1hbmQub3B0aW9ucy50aW1lb3V0O1xuICAgICAgICBjb25zdCBleGVjdXRvciAgICAgICAgID0gbmV3IEFzc2VydGlvbkV4ZWN1dG9yKGNvbW1hbmQsIGFzc2VydGlvblRpbWVvdXQsIGNhbGxzaXRlKTtcblxuICAgICAgICBleGVjdXRvci5vbmNlKCdzdGFydC1hc3NlcnRpb24tcmV0cmllcycsIHRpbWVvdXQgPT4gdGhpcy5leGVjdXRlQ29tbWFuZChuZXcgc2VydmljZUNvbW1hbmRzLlNob3dBc3NlcnRpb25SZXRyaWVzU3RhdHVzQ29tbWFuZCh0aW1lb3V0KSkpO1xuICAgICAgICBleGVjdXRvci5vbmNlKCdlbmQtYXNzZXJ0aW9uLXJldHJpZXMnLCBzdWNjZXNzID0+IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IHNlcnZpY2VDb21tYW5kcy5IaWRlQXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQoc3VjY2VzcykpKTtcblxuICAgICAgICByZXR1cm4gZXhlY3V0b3IucnVuKCk7XG4gICAgfVxuXG4gICAgX2FkanVzdENvbmZpZ3VyYXRpb25XaXRoQ29tbWFuZCAoY29tbWFuZCkge1xuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUudGVzdERvbmUpIHtcbiAgICAgICAgICAgIHRoaXMudGVzdERvbmVDb21tYW5kUXVldWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGRlYnVnTG9nZ2VyLmhpZGVCcmVha3BvaW50KHRoaXMuc2Vzc2lvbi5pZCk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zZXROYXRpdmVEaWFsb2dIYW5kbGVyKVxuICAgICAgICAgICAgdGhpcy5hY3RpdmVEaWFsb2dIYW5kbGVyID0gY29tbWFuZC5kaWFsb2dIYW5kbGVyO1xuXG4gICAgICAgIGVsc2UgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLnN3aXRjaFRvSWZyYW1lKVxuICAgICAgICAgICAgdGhpcy5hY3RpdmVJZnJhbWVTZWxlY3RvciA9IGNvbW1hbmQuc2VsZWN0b3I7XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuc3dpdGNoVG9NYWluV2luZG93KVxuICAgICAgICAgICAgdGhpcy5hY3RpdmVJZnJhbWVTZWxlY3RvciA9IG51bGw7XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuc2V0VGVzdFNwZWVkKVxuICAgICAgICAgICAgdGhpcy5zcGVlZCA9IGNvbW1hbmQuc3BlZWQ7XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuc2V0UGFnZUxvYWRUaW1lb3V0KVxuICAgICAgICAgICAgdGhpcy5wYWdlTG9hZFRpbWVvdXQgPSBjb21tYW5kLmR1cmF0aW9uO1xuXG4gICAgICAgIGVsc2UgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLmRlYnVnKVxuICAgICAgICAgICAgdGhpcy5kZWJ1Z2dpbmcgPSB0cnVlO1xuICAgIH1cblxuICAgIGFzeW5jIF9hZGp1c3RTY3JlZW5zaG90Q29tbWFuZCAoY29tbWFuZCkge1xuICAgICAgICBjb25zdCBicm93c2VySWQgICAgICAgICAgICAgICAgICAgID0gdGhpcy5icm93c2VyQ29ubmVjdGlvbi5pZDtcbiAgICAgICAgY29uc3QgeyBoYXNDaHJvbWVsZXNzU2NyZWVuc2hvdHMgfSA9IGF3YWl0IHRoaXMuYnJvd3NlckNvbm5lY3Rpb24ucHJvdmlkZXIuaGFzQ3VzdG9tQWN0aW9uRm9yQnJvd3Nlcihicm93c2VySWQpO1xuXG4gICAgICAgIGlmICghaGFzQ2hyb21lbGVzc1NjcmVlbnNob3RzKVxuICAgICAgICAgICAgY29tbWFuZC5nZW5lcmF0ZVNjcmVlbnNob3RNYXJrKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3NldEJyZWFrcG9pbnRJZk5lY2Vzc2FyeSAoY29tbWFuZCwgY2FsbHNpdGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVEZWJ1Z0JyZWFrcG9pbnRzICYmIHRoaXMuZGVidWdnaW5nICYmIGNhblNldERlYnVnZ2VyQnJlYWtwb2ludEJlZm9yZUNvbW1hbmQoY29tbWFuZCkpXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9lbnF1ZXVlU2V0QnJlYWtwb2ludENvbW1hbmQoY2FsbHNpdGUpO1xuICAgIH1cblxuICAgIGFzeW5jIGV4ZWN1dGVDb21tYW5kIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICB0aGlzLmRlYnVnTG9nLmNvbW1hbmQoY29tbWFuZCk7XG5cbiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1BhZ2VFcnJvciAmJiBpc0NvbW1hbmRSZWplY3RhYmxlQnlQYWdlRXJyb3IoY29tbWFuZCkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVqZWN0Q29tbWFuZFdpdGhQYWdlRXJyb3IoY2FsbHNpdGUpO1xuXG4gICAgICAgIGlmIChpc0V4ZWN1dGFibGVPbkNsaWVudENvbW1hbmQoY29tbWFuZCkpXG4gICAgICAgICAgICB0aGlzLmFkZGluZ0RyaXZlclRhc2tzQ291bnQrKztcblxuICAgICAgICB0aGlzLl9hZGp1c3RDb25maWd1cmF0aW9uV2l0aENvbW1hbmQoY29tbWFuZCk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5fc2V0QnJlYWtwb2ludElmTmVjZXNzYXJ5KGNvbW1hbmQsIGNhbGxzaXRlKTtcblxuICAgICAgICBpZiAoaXNTY3JlZW5zaG90Q29tbWFuZChjb21tYW5kKSlcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2FkanVzdFNjcmVlbnNob3RDb21tYW5kKGNvbW1hbmQpO1xuXG4gICAgICAgIGlmIChpc0Jyb3dzZXJNYW5pcHVsYXRpb25Db21tYW5kKGNvbW1hbmQpKVxuICAgICAgICAgICAgdGhpcy5icm93c2VyTWFuaXB1bGF0aW9uUXVldWUucHVzaChjb21tYW5kKTtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUud2FpdClcbiAgICAgICAgICAgIHJldHVybiBkZWxheShjb21tYW5kLnRpbWVvdXQpO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zZXRQYWdlTG9hZFRpbWVvdXQpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuZGVidWcpXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZW5xdWV1ZVNldEJyZWFrcG9pbnRDb21tYW5kKGNhbGxzaXRlKTtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUudXNlUm9sZSlcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl91c2VSb2xlKGNvbW1hbmQucm9sZSwgY2FsbHNpdGUpO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5hc3NlcnRpb24pXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhlY3V0ZUFzc2VydGlvbihjb21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLmV4ZWN1dGVFeHByZXNzaW9uKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2V4ZWN1dGVFeHByZXNzaW9uKGNvbW1hbmQsIGNhbGxzaXRlKTtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuZ2V0QnJvd3NlckNvbnNvbGVNZXNzYWdlcylcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9lbnF1ZXVlQnJvd3NlckNvbnNvbGVNZXNzYWdlc0NvbW1hbmQoY29tbWFuZCwgY2FsbHNpdGUpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9lbnF1ZXVlQ29tbWFuZChjb21tYW5kLCBjYWxsc2l0ZSk7XG4gICAgfVxuXG4gICAgX3JlamVjdENvbW1hbmRXaXRoUGFnZUVycm9yIChjYWxsc2l0ZSkge1xuICAgICAgICBjb25zdCBlcnIgPSB0aGlzLnBlbmRpbmdQYWdlRXJyb3I7XG5cbiAgICAgICAgZXJyLmNhbGxzaXRlICAgICAgICAgID0gY2FsbHNpdGU7XG4gICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG51bGw7XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgfVxuXG4gICAgLy8gUm9sZSBtYW5hZ2VtZW50XG4gICAgYXN5bmMgZ2V0U3RhdGVTbmFwc2hvdCAoKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5zZXNzaW9uLmdldFN0YXRlU25hcHNob3QoKTtcblxuICAgICAgICBzdGF0ZS5zdG9yYWdlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IHNlcnZpY2VDb21tYW5kcy5CYWNrdXBTdG9yYWdlc0NvbW1hbmQoKSk7XG5cbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIGFzeW5jIHN3aXRjaFRvQ2xlYW5SdW4gKCkge1xuICAgICAgICB0aGlzLmN0eCAgICAgICAgICAgICA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIHRoaXMuZml4dHVyZUN0eCAgICAgID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5jb25zb2xlTWVzc2FnZXMgPSBuZXcgQnJvd3NlckNvbnNvbGVNZXNzYWdlcygpO1xuXG4gICAgICAgIHRoaXMuc2Vzc2lvbi51c2VTdGF0ZVNuYXBzaG90KG51bGwpO1xuXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZURpYWxvZ0hhbmRsZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZURpYWxvZ0hhbmRsZXJDb21tYW5kID0gbmV3IGFjdGlvbkNvbW1hbmRzLlNldE5hdGl2ZURpYWxvZ0hhbmRsZXJDb21tYW5kKHsgZGlhbG9nSGFuZGxlcjogeyBmbjogbnVsbCB9IH0pO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKHJlbW92ZURpYWxvZ0hhbmRsZXJDb21tYW5kKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNwZWVkICE9PSB0aGlzLm9wdHMuc3BlZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNldFNwZWVkQ29tbWFuZCA9IG5ldyBhY3Rpb25Db21tYW5kcy5TZXRUZXN0U3BlZWRDb21tYW5kKHsgc3BlZWQ6IHRoaXMub3B0cy5zcGVlZCB9KTtcblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZChzZXRTcGVlZENvbW1hbmQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucGFnZUxvYWRUaW1lb3V0ICE9PSB0aGlzLm9wdHMucGFnZUxvYWRUaW1lb3V0KSB7XG4gICAgICAgICAgICBjb25zdCBzZXRQYWdlTG9hZFRpbWVvdXRDb21tYW5kID0gbmV3IGFjdGlvbkNvbW1hbmRzLlNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQoeyBkdXJhdGlvbjogdGhpcy5vcHRzLnBhZ2VMb2FkVGltZW91dCB9KTtcblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZChzZXRQYWdlTG9hZFRpbWVvdXRDb21tYW5kKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIF9nZXRTdGF0ZVNuYXBzaG90RnJvbVJvbGUgKHJvbGUpIHtcbiAgICAgICAgY29uc3QgcHJldlBoYXNlID0gdGhpcy5waGFzZTtcblxuICAgICAgICB0aGlzLnBoYXNlID0gUEhBU0UuaW5Sb2xlSW5pdGlhbGl6ZXI7XG5cbiAgICAgICAgaWYgKHJvbGUucGhhc2UgPT09IFJPTEVfUEhBU0UudW5pbml0aWFsaXplZClcbiAgICAgICAgICAgIGF3YWl0IHJvbGUuaW5pdGlhbGl6ZSh0aGlzKTtcblxuICAgICAgICBlbHNlIGlmIChyb2xlLnBoYXNlID09PSBST0xFX1BIQVNFLnBlbmRpbmdJbml0aWFsaXphdGlvbilcbiAgICAgICAgICAgIGF3YWl0IHByb21pc2lmeUV2ZW50KHJvbGUsICdpbml0aWFsaXplZCcpO1xuXG4gICAgICAgIGlmIChyb2xlLmluaXRFcnIpXG4gICAgICAgICAgICB0aHJvdyByb2xlLmluaXRFcnI7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IHByZXZQaGFzZTtcblxuICAgICAgICByZXR1cm4gcm9sZS5zdGF0ZVNuYXBzaG90O1xuICAgIH1cblxuICAgIGFzeW5jIF91c2VSb2xlIChyb2xlLCBjYWxsc2l0ZSkge1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PT0gUEhBU0UuaW5Sb2xlSW5pdGlhbGl6ZXIpXG4gICAgICAgICAgICB0aHJvdyBuZXcgUm9sZVN3aXRjaEluUm9sZUluaXRpYWxpemVyRXJyb3IoY2FsbHNpdGUpO1xuXG4gICAgICAgIHRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgPSB0cnVlO1xuXG4gICAgICAgIGNvbnN0IGJvb2ttYXJrID0gbmV3IFRlc3RSdW5Cb29rbWFyayh0aGlzLCByb2xlKTtcblxuICAgICAgICBhd2FpdCBib29rbWFyay5pbml0KCk7XG5cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFJvbGVJZClcbiAgICAgICAgICAgIHRoaXMudXNlZFJvbGVTdGF0ZXNbdGhpcy5jdXJyZW50Um9sZUlkXSA9IGF3YWl0IHRoaXMuZ2V0U3RhdGVTbmFwc2hvdCgpO1xuXG4gICAgICAgIGNvbnN0IHN0YXRlU25hcHNob3QgPSB0aGlzLnVzZWRSb2xlU3RhdGVzW3JvbGUuaWRdIHx8IGF3YWl0IHRoaXMuX2dldFN0YXRlU25hcHNob3RGcm9tUm9sZShyb2xlKTtcblxuICAgICAgICB0aGlzLnNlc3Npb24udXNlU3RhdGVTbmFwc2hvdChzdGF0ZVNuYXBzaG90KTtcblxuICAgICAgICB0aGlzLmN1cnJlbnRSb2xlSWQgPSByb2xlLmlkO1xuXG4gICAgICAgIGF3YWl0IGJvb2ttYXJrLnJlc3RvcmUoY2FsbHNpdGUsIHN0YXRlU25hcHNob3QpO1xuXG4gICAgICAgIHRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VycmVudCBVUkxcbiAgICBhc3luYyBnZXRDdXJyZW50VXJsICgpIHtcbiAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBDbGllbnRGdW5jdGlvbkJ1aWxkZXIoKCkgPT4ge1xuICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tdW5kZWYgKi9cbiAgICAgICAgfSwgeyBib3VuZFRlc3RSdW46IHRoaXMgfSk7XG5cbiAgICAgICAgY29uc3QgZ2V0TG9jYXRpb24gPSBidWlsZGVyLmdldEZ1bmN0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldExvY2F0aW9uKCk7XG4gICAgfVxuXG4gICAgX2Rpc2Nvbm5lY3QgKGVycikge1xuICAgICAgICB0aGlzLmRpc2Nvbm5lY3RlZCA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5fcmVqZWN0Q3VycmVudERyaXZlclRhc2soZXJyKTtcblxuICAgICAgICB0aGlzLmVtaXQoJ2Rpc2Nvbm5lY3RlZCcsIGVycik7XG5cbiAgICAgICAgZGVsZXRlIHRlc3RSdW5UcmFja2VyLmFjdGl2ZVRlc3RSdW5zW3RoaXMuc2Vzc2lvbi5pZF07XG4gICAgfVxufVxuXG4vLyBTZXJ2aWNlIG1lc3NhZ2UgaGFuZGxlcnNcbmNvbnN0IFNlcnZpY2VNZXNzYWdlcyA9IFRlc3RSdW4ucHJvdG90eXBlO1xuXG4vLyBOT1RFOiB0aGlzIGZ1bmN0aW9uIGlzIHRpbWUtY3JpdGljYWwgYW5kIG11c3QgcmV0dXJuIEFTQVAgdG8gYXZvaWQgY2xpZW50IGRpc2Nvbm5lY3Rpb25cblNlcnZpY2VNZXNzYWdlc1tDTElFTlRfTUVTU0FHRVMucmVhZHldID0gZnVuY3Rpb24gKG1zZykge1xuICAgIHRoaXMuZGVidWdMb2cuZHJpdmVyTWVzc2FnZShtc2cpO1xuXG4gICAgdGhpcy5lbWl0KCdjb25uZWN0ZWQnKTtcblxuICAgIHRoaXMuX2NsZWFyUGVuZGluZ1JlcXVlc3QoKTtcblxuICAgIC8vIE5PVEU6IHRoZSBkcml2ZXIgc2VuZHMgdGhlIHN0YXR1cyBmb3IgdGhlIHNlY29uZCB0aW1lIGlmIGl0IGRpZG4ndCBnZXQgYSByZXNwb25zZSBhdCB0aGVcbiAgICAvLyBmaXJzdCB0cnkuIFRoaXMgaXMgcG9zc2libGUgd2hlbiB0aGUgcGFnZSB3YXMgdW5sb2FkZWQgYWZ0ZXIgdGhlIGRyaXZlciBzZW50IHRoZSBzdGF0dXMuXG4gICAgaWYgKG1zZy5zdGF0dXMuaWQgPT09IHRoaXMubGFzdERyaXZlclN0YXR1c0lkKVxuICAgICAgICByZXR1cm4gdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2U7XG5cbiAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNJZCAgICAgICA9IG1zZy5zdGF0dXMuaWQ7XG4gICAgdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2UgPSB0aGlzLl9oYW5kbGVEcml2ZXJSZXF1ZXN0KG1zZy5zdGF0dXMpO1xuXG4gICAgaWYgKHRoaXMubGFzdERyaXZlclN0YXR1c1Jlc3BvbnNlKVxuICAgICAgICByZXR1cm4gdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2U7XG5cbiAgICAvLyBOT1RFOiB3ZSBzZW5kIGFuIGVtcHR5IHJlc3BvbnNlIGFmdGVyIHRoZSBNQVhfUkVTUE9OU0VfREVMQVkgdGltZW91dCBpcyBleGNlZWRlZCB0byBrZWVwIGNvbm5lY3Rpb25cbiAgICAvLyB3aXRoIHRoZSBjbGllbnQgYW5kIHByZXZlbnQgdGhlIHJlc3BvbnNlIHRpbWVvdXQgZXhjZXB0aW9uIG9uIHRoZSBjbGllbnQgc2lkZVxuICAgIGNvbnN0IHJlc3BvbnNlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5fcmVzb2x2ZVBlbmRpbmdSZXF1ZXN0KG51bGwpLCBNQVhfUkVTUE9OU0VfREVMQVkpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgdGhpcy5wZW5kaW5nUmVxdWVzdCA9IHsgcmVzb2x2ZSwgcmVqZWN0LCByZXNwb25zZVRpbWVvdXQgfTtcbiAgICB9KTtcbn07XG5cblNlcnZpY2VNZXNzYWdlc1tDTElFTlRfTUVTU0FHRVMucmVhZHlGb3JCcm93c2VyTWFuaXB1bGF0aW9uXSA9IGFzeW5jIGZ1bmN0aW9uIChtc2cpIHtcbiAgICB0aGlzLmRlYnVnTG9nLmRyaXZlck1lc3NhZ2UobXNnKTtcblxuICAgIGxldCByZXN1bHQgPSBudWxsO1xuICAgIGxldCBlcnJvciAgPSBudWxsO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5icm93c2VyTWFuaXB1bGF0aW9uUXVldWUuZXhlY3V0ZVBlbmRpbmdNYW5pcHVsYXRpb24obXNnKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycikge1xuICAgICAgICBlcnJvciA9IGVycjtcbiAgICB9XG5cbiAgICByZXR1cm4geyByZXN1bHQsIGVycm9yIH07XG59O1xuXG5TZXJ2aWNlTWVzc2FnZXNbQ0xJRU5UX01FU1NBR0VTLndhaXRGb3JGaWxlRG93bmxvYWRdID0gZnVuY3Rpb24gKG1zZykge1xuICAgIHRoaXMuZGVidWdMb2cuZHJpdmVyTWVzc2FnZShtc2cpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBpZiAodGhpcy5maWxlRG93bmxvYWRpbmdIYW5kbGVkKSB7XG4gICAgICAgICAgICB0aGlzLmZpbGVEb3dubG9hZGluZ0hhbmRsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5yZXNvbHZlV2FpdEZvckZpbGVEb3dubG9hZGluZ1Byb21pc2UgPSByZXNvbHZlO1xuICAgIH0pO1xufTtcbiJdfQ==
